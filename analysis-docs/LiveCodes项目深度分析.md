# LiveCodes é¡¹ç›®æ·±åº¦åˆ†æ

## ğŸ“š æ–‡æ¡£å¯¼èˆª

æœ¬æ–‡æ¡£æä¾›äº† LiveCodes é¡¹ç›®çš„æ•´ä½“æ¦‚è§ˆå’Œæ¶æ„åˆ†æã€‚æ›´è¯¦ç»†çš„æŠ€æœ¯å®ç°è¯·å‚è€ƒä»¥ä¸‹ä¸“é¢˜æ–‡æ¡£ï¼š

### ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£
- **[ç¼–è¯‘å™¨ç³»ç»Ÿæ¶æ„è¯¦è§£](./ç¼–è¯‘å™¨ç³»ç»Ÿæ¶æ„è¯¦è§£.md)** - æ·±å…¥è§£æå¦‚ä½•æ”¯æŒ 90+ ç§è¯­è¨€çš„ç¼–è¯‘ç³»ç»Ÿ
- **[SDKè®¾è®¡æ¶æ„è¯¦è§£](./SDKè®¾è®¡æ¶æ„è¯¦è§£.md)** - è¯¦ç»†ä»‹ç»å¤šæ¡†æ¶ SDK çš„è®¾è®¡å’Œå®ç°
- **[è¯­è¨€æ”¯æŒæœºåˆ¶è¯¦è§£](./è¯­è¨€æ”¯æŒæœºåˆ¶è¯¦è§£.md)** - å…¨é¢åˆ†æè¯­è¨€æ”¯æŒçš„å®ç°æœºåˆ¶

### ğŸ“– å®Œæ•´æ–‡æ¡£ç›®å½•
- **[åˆ†ææ–‡æ¡£æ€»è§ˆ](./README.md)** - æŸ¥çœ‹æ‰€æœ‰åˆ†ææ–‡æ¡£çš„å®Œæ•´ç›®å½•å’Œå­¦ä¹ è·¯å¾„

---

## é¡¹ç›®æ¦‚è¿°

LiveCodes æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å¼€æºå®¢æˆ·ç«¯ä»£ç æ¸¸ä¹åœºï¼Œæ”¯æŒ 90+ ç§ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ç¼–è¾‘å™¨å’Œæ‰§è¡Œç¯å¢ƒï¼Œæ— éœ€æœåŠ¡å™¨é…ç½®ï¼Œå¯ä»¥ä½œä¸ºç‹¬ç«‹åº”ç”¨ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åµŒå…¥åˆ°ä»»ä½•ç½‘é¡µä¸­ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

- **å®¢æˆ·ç«¯è¿è¡Œ**ï¼šå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ— éœ€æœåŠ¡å™¨
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒ 90+ ç§è¯­è¨€/æ¡†æ¶/å¤„ç†å™¨
- **é›¶é…ç½®**ï¼šæ— éœ€å®‰è£…ã€é…ç½®æ–‡ä»¶æˆ–æ„å»ºæ­¥éª¤
- **å¼ºå¤§çš„ SDK**ï¼šæä¾› JavaScript/TypeScriptã€Reactã€Vueã€Svelte ç­‰å¤šç§ SDK
- **åµŒå…¥å‹å¥½**ï¼šå¯è½»æ¾åµŒå…¥åˆ°ä»»ä½•ç½‘é¡µä¸­
- **éšç§ä¼˜å…ˆ**ï¼šä»£ç é»˜è®¤ç§æœ‰ï¼Œå­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°

## æŠ€æœ¯æ¶æ„

### 1. æ•´ä½“æ¶æ„è®¾è®¡

LiveCodes é‡‡ç”¨æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

```
src/livecodes/
â”œâ”€â”€ core.ts              # æ ¸å¿ƒåˆå§‹åŒ–é€»è¾‘
â”œâ”€â”€ main.ts              # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ app.ts               # åº”ç”¨å…¥å£
â”œâ”€â”€ embed.ts             # åµŒå…¥æ¨¡å¼å…¥å£
â”œâ”€â”€ compiler/            # ç¼–è¯‘å™¨ç³»ç»Ÿ
â”œâ”€â”€ languages/           # è¯­è¨€æ”¯æŒ
â”œâ”€â”€ editor/              # ç¼–è¾‘å™¨é›†æˆ
â”œâ”€â”€ result/              # ç»“æœé¡µé¢
â”œâ”€â”€ services/            # å¤–éƒ¨æœåŠ¡
â”œâ”€â”€ storage/             # å­˜å‚¨ç³»ç»Ÿ
â”œâ”€â”€ UI/                  # ç”¨æˆ·ç•Œé¢
â””â”€â”€ sdk/                 # SDK å®ç°
```

### 2. ç¼–è¯‘å™¨ç³»ç»Ÿæ¶æ„

LiveCodes çš„ç¼–è¯‘å™¨ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒåˆ›æ–°ä¹‹ä¸€ï¼Œé‡‡ç”¨äº†çµæ´»çš„æ’ä»¶åŒ–æ¶æ„ï¼š

> ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [ç¼–è¯‘å™¨ç³»ç»Ÿæ¶æ„è¯¦è§£](./ç¼–è¯‘å™¨ç³»ç»Ÿæ¶æ„è¯¦è§£.md)

#### ç¼–è¯‘å™¨æ¥å£è®¾è®¡
```typescript
export interface LanguageSpecs {
  name: Language;
  title: string;
  compiler: Compiler | Language;
  extensions: Language[];
  editor: EditorId;
  // ... å…¶ä»–é…ç½®
}
```

#### ç¼–è¯‘æµç¨‹
1. **è¯­è¨€æ£€æµ‹**ï¼šæ ¹æ®æ–‡ä»¶æ‰©å±•åæˆ–ç”¨æˆ·é€‰æ‹©ç¡®å®šè¯­è¨€
2. **ç¼–è¯‘å™¨åŠ è½½**ï¼šåŠ¨æ€åŠ è½½å¯¹åº”çš„ç¼–è¯‘å™¨
3. **ä»£ç ç¼–è¯‘**ï¼šä½¿ç”¨ Web Workers è¿›è¡Œç¼–è¯‘
4. **åå¤„ç†**ï¼šåº”ç”¨å¤„ç†å™¨ï¼ˆå¦‚ PostCSSã€Babel ç­‰ï¼‰
5. **ç»“æœè¾“å‡º**ï¼šç”Ÿæˆå¯æ‰§è¡Œçš„ä»£ç 

#### æ”¯æŒçš„ç¼–è¯‘æ–¹å¼
- **åœ¨çº¿ç¼–è¯‘å™¨**ï¼šå¦‚ TypeScriptã€Babelã€Sass ç­‰
- **WebAssembly**ï¼šå¦‚ Pythonã€Rubyã€PHP ç­‰
- **è§£é‡Šæ‰§è¡Œ**ï¼šå¦‚ JavaScriptã€HTMLã€CSS
- **è½¬è¯‘å™¨**ï¼šå¦‚ CoffeeScriptã€LiveScript ç­‰

### 3. è¯­è¨€æ”¯æŒæœºåˆ¶

LiveCodes é€šè¿‡ç»Ÿä¸€çš„è¯­è¨€è§„èŒƒæ”¯æŒ 90+ ç§è¯­è¨€ï¼š

> ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [è¯­è¨€æ”¯æŒæœºåˆ¶è¯¦è§£](./è¯­è¨€æ”¯æŒæœºåˆ¶è¯¦è§£.md)

#### è¯­è¨€å®šä¹‰ç¤ºä¾‹
```typescript
export const typescript: LanguageSpecs = {
  name: 'typescript',
  title: 'TS',
  longTitle: 'TypeScript',
  compiler: {
    url: typescriptUrl,
    factory: () => async (code, { config }) =>
      (window as any).ts.transpile(code, {
        ...typescriptOptions,
        ...getLanguageCustomSettings('typescript', config),
      }),
  },
  extensions: ['ts', 'typescript'],
  editor: 'script',
};
```

#### ç¼–è¯‘å™¨ç±»å‹
1. **JavaScript ç¼–è¯‘å™¨**ï¼šç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
2. **WebAssembly ç¼–è¯‘å™¨**ï¼šç¼–è¯‘ä¸º WASM è¿è¡Œ
3. **Web Workers ç¼–è¯‘å™¨**ï¼šåœ¨åå°çº¿ç¨‹ä¸­ç¼–è¯‘
4. **å¤–éƒ¨æœåŠ¡ç¼–è¯‘å™¨**ï¼šè°ƒç”¨å¤–éƒ¨ API ç¼–è¯‘

### 4. SDK è®¾è®¡æ¶æ„

LiveCodes æä¾›äº†å¼ºå¤§çš„ SDKï¼Œæ”¯æŒå¤šç§å‰ç«¯æ¡†æ¶ï¼š

> ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [SDKè®¾è®¡æ¶æ„è¯¦è§£](./SDKè®¾è®¡æ¶æ„è¯¦è§£.md)

#### æ ¸å¿ƒ SDK æ¥å£
```typescript
export interface API {
  run: () => Promise<void>;
  format: (allEditors?: boolean) => Promise<void>;
  getShareUrl: (shortUrl?: boolean) => Promise<string>;
  getConfig: (contentOnly?: boolean) => Promise<Config>;
  setConfig: (config: Partial<Config>) => Promise<Config>;
  getCode: () => Promise<Code>;
  show: (panel: string, options?: any) => Promise<void>;
  runTests: () => Promise<{ results: TestResult[] }>;
  watch: WatchFn;
  exec: (command: APICommands, ...args: any[]) => Promise<any>;
  destroy: () => Promise<void>;
}
```

#### é€šä¿¡æœºåˆ¶
- **PostMessage API**ï¼šiframe ä¸çˆ¶é¡µé¢é€šä¿¡
- **äº‹ä»¶ç³»ç»Ÿ**ï¼šåŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼
- **Promise å°è£…**ï¼šå¼‚æ­¥æ“ä½œçš„ç»Ÿä¸€å¤„ç†

#### æ¡†æ¶é›†æˆ
1. **React ç»„ä»¶**
```jsx
import LiveCodes from 'livecodes/react';

const Playground = () => (
  <LiveCodes 
    config={config} 
    view="result" 
    onSdkReady={(playground) => {
      // SDK å°±ç»ªå›è°ƒ
    }}
  />
);
```

2. **Vue ç»„ä»¶**
```vue
<template>
  <LiveCodes :config="config" view="result" />
</template>

<script setup>
import LiveCodes from 'livecodes/vue';
</script>
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç¼–è¾‘å™¨é›†æˆ

LiveCodes é›†æˆäº†å¤šç§ä»£ç ç¼–è¾‘å™¨ï¼š

- **Monaco Editor**ï¼šVS Code çš„ç¼–è¾‘å™¨æ ¸å¿ƒ
- **CodeMirror**ï¼šè½»é‡çº§ä»£ç ç¼–è¾‘å™¨
- **CodeJar**ï¼šæç®€ä»£ç ç¼–è¾‘å™¨
- **Blockly**ï¼šå¯è§†åŒ–ç¼–ç¨‹ç¼–è¾‘å™¨
- **Quill**ï¼šå¯Œæ–‡æœ¬ç¼–è¾‘å™¨

### 2. ç»“æœé¡µé¢ç³»ç»Ÿ

ç»“æœé¡µé¢ç³»ç»Ÿè´Ÿè´£æ‰§è¡Œå’Œæ˜¾ç¤ºä»£ç è¿è¡Œç»“æœï¼š

- **æ²™ç®±æ‰§è¡Œ**ï¼šåœ¨ iframe ä¸­å®‰å…¨æ‰§è¡Œä»£ç 
- **å®æ—¶é¢„è§ˆ**ï¼šä»£ç å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°ç»“æœ
- **é”™è¯¯å¤„ç†**ï¼šæ•è·å’Œæ˜¾ç¤ºè¿è¡Œæ—¶é”™è¯¯
- **æ§åˆ¶å°é›†æˆ**ï¼šæ˜¾ç¤º console è¾“å‡º

### 3. å­˜å‚¨ç³»ç»Ÿ

- **æœ¬åœ°å­˜å‚¨**ï¼šä½¿ç”¨ IndexedDB å­˜å‚¨é¡¹ç›®
- **äº‘åŒæ­¥**ï¼šæ”¯æŒ GitHub é›†æˆ
- **å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒå¤šç§æ ¼å¼çš„é¡¹ç›®å¯¼å…¥å¯¼å‡º
- **æ¨¡æ¿ç³»ç»Ÿ**ï¼šå†…ç½®å’Œç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿

### 4. æœåŠ¡é›†æˆ

- **GitHub é›†æˆ**ï¼šé¡¹ç›®åŒæ­¥ã€Gist å¯¼å…¥å¯¼å‡º
- **CDN æœåŠ¡**ï¼šæ¨¡å—å’Œèµ„æºåŠ è½½
- **åˆ†äº«æœåŠ¡**ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥
- **éƒ¨ç½²æœåŠ¡**ï¼šä¸€é”®éƒ¨ç½²åˆ°å¤šä¸ªå¹³å°

## æŠ€æœ¯æ ˆé€‰æ‹©

### å‰ç«¯æŠ€æœ¯
- **TypeScript**ï¼šç±»å‹å®‰å…¨çš„ JavaScript
- **ESBuild**ï¼šå¿«é€Ÿçš„æ„å»ºå·¥å…·
- **SCSS**ï¼šCSS é¢„å¤„ç†å™¨
- **Web Workers**ï¼šåå°ç¼–è¯‘å¤„ç†

### ç¼–è¾‘å™¨æŠ€æœ¯
- **Monaco Editor**ï¼šæä¾› VS Code çº§åˆ«çš„ç¼–è¾‘ä½“éªŒ
- **CodeMirror 6**ï¼šç°ä»£åŒ–çš„ä»£ç ç¼–è¾‘å™¨
- **Prism.js**ï¼šè¯­æ³•é«˜äº®

### ç¼–è¯‘æŠ€æœ¯
- **Babel**ï¼šJavaScript è½¬è¯‘
- **TypeScript Compiler**ï¼šTypeScript ç¼–è¯‘
- **WebAssembly**ï¼šé«˜æ€§èƒ½è¯­è¨€è¿è¡Œæ—¶
- **PostCSS**ï¼šCSS åå¤„ç†

### æ„å»ºå’Œéƒ¨ç½²
- **ESBuild**ï¼šå¿«é€Ÿæ„å»º
- **GitHub Actions**ï¼šCI/CD
- **Cloudflare Pages**ï¼šé™æ€ç«™ç‚¹æ‰˜ç®¡
- **jsDelivr**ï¼šCDN æœåŠ¡

## é¡¹ç›®åˆ›æ–°ç‚¹

### 1. å®¢æˆ·ç«¯ç¼–è¯‘æ¶æ„
- å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ— éœ€æœåŠ¡å™¨
- æ”¯æŒ 90+ ç§è¯­è¨€çš„å®¢æˆ·ç«¯ç¼–è¯‘
- WebAssembly é›†æˆå®ç°é«˜æ€§èƒ½è¯­è¨€æ”¯æŒ

### 2. æ¨¡å—åŒ–è¯­è¨€æ”¯æŒ
- ç»Ÿä¸€çš„è¯­è¨€è§„èŒƒæ¥å£
- åŠ¨æ€åŠ è½½ç¼–è¯‘å™¨
- å¯æ‰©å±•çš„è¯­è¨€æ’ä»¶ç³»ç»Ÿ

### 3. å¼ºå¤§çš„ SDK è®¾è®¡
- æ¡†æ¶æ— å…³çš„æ ¸å¿ƒ SDK
- å¤šæ¡†æ¶ç»„ä»¶å°è£…
- å®Œå–„çš„äº‹ä»¶ç³»ç»Ÿå’Œé€šä¿¡æœºåˆ¶

### 4. åµŒå…¥å¼è®¾è®¡
- è½»é‡çº§åµŒå…¥æ¨¡å¼
- çµæ´»çš„é…ç½®é€‰é¡¹
- æ— ç¼é›†æˆåˆ°ä»»ä½•ç½‘é¡µ

### 5. å¼€å‘è€…ä½“éªŒ
- é›¶é…ç½®å¯åŠ¨
- å®æ—¶é¢„è§ˆ
- ä¸°å¯Œçš„æ¨¡æ¿åº“
- å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹

## å¼€å‘å’Œæ„å»ºæµç¨‹

### å¼€å‘ç¯å¢ƒ
```bash
npm start          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run docs       # å¯åŠ¨æ–‡æ¡£æœåŠ¡å™¨
npm run storybook  # å¯åŠ¨ Storybook
```

### æ„å»ºæµç¨‹
```bash
npm run build      # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build:app  # æ„å»ºåº”ç”¨
npm run build:sdk  # æ„å»º SDK
npm run build:docs # æ„å»ºæ–‡æ¡£
```

### æµ‹è¯•ä½“ç³»
- **å•å…ƒæµ‹è¯•**ï¼šJest + jsdom
- **E2E æµ‹è¯•**ï¼šPlaywright
- **ç±»å‹æ£€æŸ¥**ï¼šTypeScript
- **ä»£ç è´¨é‡**ï¼šESLint + Prettier

## éƒ¨ç½²æ¶æ„

### é™æ€èµ„æºéƒ¨ç½²
- **ä¸»åº”ç”¨**ï¼šéƒ¨ç½²åˆ° Cloudflare Pages
- **CDN èµ„æº**ï¼šé€šè¿‡ jsDelivr åˆ†å‘
- **æ–‡æ¡£ç«™ç‚¹**ï¼šDocusaurus æ„å»ºçš„æ–‡æ¡£

### ç‰ˆæœ¬ç®¡ç†
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**ï¼šéµå¾ª SemVer è§„èŒƒ
- **è‡ªåŠ¨å‘å¸ƒ**ï¼šGitHub Actions è‡ªåŠ¨åŒ–
- **å¤šç¯å¢ƒéƒ¨ç½²**ï¼šå¼€å‘ç‰ˆå’Œç”Ÿäº§ç‰ˆ

## æ€»ç»“

LiveCodes æ˜¯ä¸€ä¸ªæŠ€æœ¯å…ˆè¿›ã€æ¶æ„ä¼˜é›…çš„ä»£ç æ¸¸ä¹åœºé¡¹ç›®ï¼Œå…¶ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š

1. **æŠ€æœ¯åˆ›æ–°**ï¼šå®¢æˆ·ç«¯ç¼–è¯‘ã€WebAssembly é›†æˆã€æ¨¡å—åŒ–æ¶æ„
2. **ç”¨æˆ·ä½“éªŒ**ï¼šé›¶é…ç½®ã€å®æ—¶é¢„è§ˆã€ä¸°å¯ŒåŠŸèƒ½
3. **å¼€å‘è€…å‹å¥½**ï¼šå¼ºå¤§ SDKã€å¤šæ¡†æ¶æ”¯æŒã€å®Œå–„æ–‡æ¡£
4. **å¯æ‰©å±•æ€§**ï¼šæ’ä»¶åŒ–è¯­è¨€æ”¯æŒã€æ¨¡å—åŒ–è®¾è®¡
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šWeb Workersã€ç¼“å­˜æœºåˆ¶ã€æŒ‰éœ€åŠ è½½

è¿™ä¸ªé¡¹ç›®ä¸ºæ„å»ºç±»ä¼¼çš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨æä¾›äº†ä¼˜ç§€çš„å‚è€ƒæ¶æ„å’Œå®ç°æ–¹æ¡ˆã€‚

## è¯¦ç»†æŠ€æœ¯å®ç°

### 1. ç¼–è¯‘å™¨ç³»ç»Ÿæ·±åº¦è§£æ

#### ç¼–è¯‘å™¨å·¥å‚æ¨¡å¼
LiveCodes ä½¿ç”¨å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒè¯­è¨€çš„ç¼–è¯‘å™¨ï¼š

```typescript
// ç¼–è¯‘å™¨å·¥å‚æ¥å£
interface CompilerFactory {
  (config: Config, baseUrl: string): CompilerFunction;
}

// ç¼–è¯‘å™¨å‡½æ•°æ¥å£
interface CompilerFunction {
  (code: string, options: CompileOptions): Promise<string | CompileResult>;
}
```

#### åŠ¨æ€ç¼–è¯‘å™¨åŠ è½½
```typescript
const loadLanguageCompiler = async (language: Language, config: Config) => {
  const specs = getLanguageSpecs(language);
  if (!specs?.compiler) return;

  // åŠ¨æ€åŠ è½½ç¼–è¯‘å™¨è„šæœ¬
  if (typeof specs.compiler === 'object' && specs.compiler.url) {
    await loadScript(specs.compiler.url);

    // åˆ›å»ºç¼–è¯‘å™¨å®ä¾‹
    const factory = specs.compiler.factory;
    if (factory) {
      compilers[language] = {
        fn: await factory(config, baseUrl),
        loaded: true
      };
    }
  }
};
```

#### Web Workers ç¼–è¯‘
ä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼ŒLiveCodes åœ¨ Web Workers ä¸­è¿›è¡Œç¼–è¯‘ï¼š

```typescript
// compile.worker.ts
const compile = async (
  content: string,
  language: LanguageOrProcessor,
  config: Config,
  options: CompileOptions,
) => {
  const compiler = compilers[language]?.fn;
  if (!compiler) {
    throw new Error('Failed to load compiler for: ' + language);
  }

  try {
    return await compiler(content, { config, language, baseUrl, options });
  } catch (err) {
    console.error('Failed compiling: ' + language, err);
    return content;
  }
};
```

### 2. è¯­è¨€æ”¯æŒå®ç°ç»†èŠ‚

#### TypeScript ç¼–è¯‘å™¨å®ç°
```typescript
export const typescript: LanguageSpecs = {
  name: 'typescript',
  title: 'TS',
  compiler: {
    url: typescriptUrl,
    factory: () => async (code, { config }) =>
      (window as any).ts.transpile(code, {
        target: 'ES2020',
        module: 'ESNext',
        jsx: 'react-jsx',
        ...getLanguageCustomSettings('typescript', config),
      }),
  },
  extensions: ['ts', 'typescript'],
  editor: 'script',
};
```

#### WebAssembly è¯­è¨€æ”¯æŒï¼ˆä»¥ Python ä¸ºä¾‹ï¼‰
```typescript
export const pythonWasm: LanguageSpecs = {
  name: 'python-wasm',
  title: 'Python (Wasm)',
  compiler: {
    factory: () => async (code) => code,
    scripts: ({ baseUrl }) => [
      baseUrl + 'pyodide/pyodide.js',
    ],
    scriptType: 'text/python-wasm',
    compiledCodeLanguage: 'python',
  },
  extensions: ['py'],
  editor: 'script',
};
```

#### æ¨¡æ¿è¯­è¨€æ”¯æŒï¼ˆä»¥ Vue ä¸ºä¾‹ï¼‰
```typescript
export const vue: LanguageSpecs = {
  name: 'vue',
  title: 'Vue 3 SFC',
  compiler: {
    factory: (_config, baseUrl) => {
      // åŠ¨æ€å¯¼å…¥ Vue ç¼–è¯‘å™¨
      return async (code, { config }) => {
        const { compile } = await import('@vue/compiler-sfc');
        const { descriptor } = compile(code);

        // ç¼–è¯‘æ¨¡æ¿ã€è„šæœ¬å’Œæ ·å¼
        return compileVueComponent(descriptor, config);
      };
    },
  },
  extensions: ['vue'],
  editor: 'script',
};
```

### 3. ç¼–è¾‘å™¨é›†æˆæ¶æ„

#### ç¼–è¾‘å™¨æŠ½è±¡å±‚
```typescript
interface CodeEditor {
  getValue(): string;
  setValue(value: string): void;
  getLanguage(): Language;
  setLanguage(language: Language): void;
  focus(): void;
  format(): Promise<void>;
  destroy(): void;
  // ... å…¶ä»–æ–¹æ³•
}
```

#### Monaco Editor é›†æˆ
```typescript
const createMonacoEditor = async (container: HTMLElement): Promise<CodeEditor> => {
  const monaco = await import('monaco-editor');

  const editor = monaco.editor.create(container, {
    value: '',
    language: 'javascript',
    theme: 'vs-dark',
    automaticLayout: true,
    minimap: { enabled: false },
    // ... å…¶ä»–é…ç½®
  });

  return {
    getValue: () => editor.getValue(),
    setValue: (value) => editor.setValue(value),
    setLanguage: (language) => {
      const model = editor.getModel();
      if (model) {
        monaco.editor.setModelLanguage(model, language);
      }
    },
    // ... å®ç°å…¶ä»–æ–¹æ³•
  };
};
```

### 4. ç»“æœé¡µé¢ç³»ç»Ÿå®ç°

#### æ²™ç®±æ‰§è¡Œç¯å¢ƒ
```typescript
const createResultPage = async (code: Code, config: Config) => {
  const iframe = document.createElement('iframe');
  iframe.sandbox = 'allow-scripts allow-same-origin allow-forms';

  const html = `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <style>${code.style.compiled}</style>
    </head>
    <body>
      ${code.markup.compiled}
      <script type="module">${code.script.compiled}</script>
    </body>
    </html>
  `;

  iframe.srcdoc = html;
  return iframe;
};
```

#### å®æ—¶é¢„è§ˆæœºåˆ¶
```typescript
const setupLivePreview = (editors: Editors, resultContainer: HTMLElement) => {
  let debounceTimer: number;

  const updateResult = async () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(async () => {
      const code = await getCompiledCode(editors);
      const resultPage = await createResultPage(code, getConfig());

      // æ›¿æ¢ç»“æœé¡µé¢
      resultContainer.innerHTML = '';
      resultContainer.appendChild(resultPage);
    }, 500);
  };

  // ç›‘å¬ç¼–è¾‘å™¨å˜åŒ–
  Object.values(editors).forEach(editor => {
    editor.onChange(updateResult);
  });
};
```

### 5. SDK é€šä¿¡æœºåˆ¶

#### PostMessage é€šä¿¡
```typescript
// SDK ç«¯
const callAPI = <T>(method: keyof API, args?: any[]) =>
  new Promise<T>((resolve, reject) => {
    const id = generateId();

    // ç›‘å¬å“åº”
    const handler = (e: MessageEvent) => {
      if (e.data?.id === id && e.data?.method === method) {
        window.removeEventListener('message', handler);
        if (e.data.error) {
          reject(e.data.error);
        } else {
          resolve(e.data.payload);
        }
      }
    };

    window.addEventListener('message', handler);

    // å‘é€è¯·æ±‚
    iframe.contentWindow?.postMessage({ method, id, args }, origin);
  });

// LiveCodes ç«¯
window.addEventListener('message', async (e) => {
  const { method, id, args } = e.data;

  try {
    const result = await api[method](...(args || []));
    e.source?.postMessage({
      type: 'livecodes-api-response',
      method,
      id,
      payload: result
    }, e.origin);
  } catch (error) {
    e.source?.postMessage({
      type: 'livecodes-api-response',
      method,
      id,
      payload: { error: error.message }
    }, e.origin);
  }
});
```

#### äº‹ä»¶ç³»ç»Ÿå®ç°
```typescript
// å‘å¸ƒ-è®¢é˜…æ¨¡å¼
const createPub = <T>() => {
  const subscribers = new Set<(data: T) => void>();

  return {
    subscribe: (fn: (data: T) => void) => {
      subscribers.add(fn);
      return {
        remove: () => subscribers.delete(fn)
      };
    },
    publish: (data: T) => {
      subscribers.forEach(fn => fn(data));
    }
  };
};

// SDK äº‹ä»¶ç›‘å¬
const sdkWatchers = {
  load: createPub<void>(),
  ready: createPub<void>(),
  code: createPub<{ code: Code; config: Config }>(),
  tests: createPub<{ results: TestResult[] }>(),
  console: createPub<{ method: string; args: any[] }>(),
  destroy: createPub<void>(),
};
```

### 6. æ¨¡å—åŠ è½½å’Œç¼“å­˜æœºåˆ¶

#### åŠ¨æ€æ¨¡å—åŠ è½½
```typescript
const moduleCache = new Map<string, any>();

const loadModule = async (url: string): Promise<any> => {
  if (moduleCache.has(url)) {
    return moduleCache.get(url);
  }

  try {
    const module = await import(url);
    moduleCache.set(url, module);
    return module;
  } catch (error) {
    console.error(`Failed to load module: ${url}`, error);
    throw error;
  }
};
```

#### ç¼–è¯‘ç¼“å­˜
```typescript
interface CompileCache {
  content: string;
  compiled: string;
  processors: string;
  languageSettings: string;
  timestamp: number;
}

const cache = new Map<Language, CompileCache>();

const getCachedResult = (
  language: Language,
  content: string,
  processors: string,
  settings: string
): string | null => {
  const cached = cache.get(language);
  if (
    cached &&
    cached.content === content &&
    cached.processors === processors &&
    cached.languageSettings === settings
  ) {
    return cached.compiled;
  }
  return null;
};

### 7. å­˜å‚¨ç³»ç»Ÿæ¶æ„

#### é¡¹ç›®å­˜å‚¨æ¥å£
```typescript
interface ProjectStorage {
  getProject(id: string): Promise<Config | null>;
  saveProject(project: Config): Promise<string>;
  deleteProject(id: string): Promise<void>;
  listProjects(): Promise<Array<{ id: string; title: string; lastModified: number }>>;
}
```

#### IndexedDB å®ç°
```typescript
class IndexedDBStorage implements ProjectStorage {
  private db: IDBDatabase | null = null;

  async init() {
    return new Promise<void>((resolve, reject) => {
      const request = indexedDB.open('livecodes', 1);

      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve();
      };

      request.onupgradeneeded = (event) => {
        const db = (event.target as IDBOpenDBRequest).result;

        // åˆ›å»ºé¡¹ç›®å­˜å‚¨
        if (!db.objectStoreNames.contains('projects')) {
          const store = db.createObjectStore('projects', { keyPath: 'id' });
          store.createIndex('lastModified', 'lastModified');
        }
      };
    });
  }

  async saveProject(project: Config): Promise<string> {
    if (!this.db) await this.init();

    const id = project.id || generateId();
    const projectData = {
      ...project,
      id,
      lastModified: Date.now()
    };

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction(['projects'], 'readwrite');
      const store = transaction.objectStore('projects');
      const request = store.put(projectData);

      request.onsuccess = () => resolve(id);
      request.onerror = () => reject(request.error);
    });
  }
}
```

### 8. å›½é™…åŒ–ç³»ç»Ÿ

#### i18n æ¶æ„
```typescript
interface I18nSystem {
  init(language: string): Promise<void>;
  t(key: string, params?: Record<string, any>): string;
  changeLanguage(language: string): Promise<void>;
  getAvailableLanguages(): string[];
}

// ç¿»è¯‘é”®ç±»å‹å®šä¹‰
type I18nKeyType =
  | 'app.title'
  | 'editor.run'
  | 'editor.format'
  | 'templates.starter.react'
  // ... æ›´å¤šé”®
```

#### åŠ¨æ€è¯­è¨€åŠ è½½
```typescript
const loadLanguageResources = async (language: string) => {
  try {
    const resources = await import(`./locales/${language}.json`);
    return resources.default;
  } catch (error) {
    console.warn(`Failed to load language: ${language}, falling back to English`);
    return await import('./locales/en.json').then(m => m.default);
  }
};
```

### 9. æµ‹è¯•ç³»ç»Ÿæ¶æ„

#### å•å…ƒæµ‹è¯•ç»“æ„
```typescript
// æµ‹è¯•å·¥å…·å‡½æ•°
const createMockEditor = (): CodeEditor => ({
  getValue: jest.fn(() => ''),
  setValue: jest.fn(),
  getLanguage: jest.fn(() => 'javascript'),
  setLanguage: jest.fn(),
  focus: jest.fn(),
  format: jest.fn(() => Promise.resolve()),
  destroy: jest.fn(),
});

// ç¼–è¯‘å™¨æµ‹è¯•
describe('TypeScript Compiler', () => {
  it('should compile TypeScript to JavaScript', async () => {
    const compiler = await createCompiler({ language: 'typescript' });
    const result = await compiler.compile('const x: number = 1;');
    expect(result.code).toContain('const x = 1;');
  });
});
```

#### E2E æµ‹è¯•
```typescript
// Playwright æµ‹è¯•
test('should create and run a React project', async ({ page }) => {
  await page.goto('/');

  // é€‰æ‹© React æ¨¡æ¿
  await page.click('[data-testid="template-react"]');

  // ç­‰å¾…ç¼–è¾‘å™¨åŠ è½½
  await page.waitForSelector('.monaco-editor');

  // ä¿®æ”¹ä»£ç 
  await page.fill('.monaco-editor textarea', 'console.log("Hello World");');

  // è¿è¡Œä»£ç 
  await page.click('[data-testid="run-button"]');

  // éªŒè¯ç»“æœ
  await expect(page.locator('[data-testid="console-output"]')).toContainText('Hello World');
});
```

### 10. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### ä»£ç åˆ†å‰²
```typescript
// åŠ¨æ€å¯¼å…¥å¤§å‹ä¾èµ–
const loadMonacoEditor = () => import('monaco-editor');
const loadCodeMirror = () => import('@codemirror/state');

// æŒ‰éœ€åŠ è½½è¯­è¨€ç¼–è¯‘å™¨
const loadLanguageCompiler = async (language: Language) => {
  switch (language) {
    case 'typescript':
      return import('./languages/typescript/compiler');
    case 'python':
      return import('./languages/python/compiler');
    // ... å…¶ä»–è¯­è¨€
  }
};
```

#### è™šæ‹Ÿæ»šåŠ¨
```typescript
// å¤§å‹é¡¹ç›®åˆ—è¡¨çš„è™šæ‹Ÿæ»šåŠ¨
const VirtualProjectList = ({ projects }: { projects: Project[] }) => {
  const [visibleRange, setVisibleRange] = useState({ start: 0, end: 50 });

  const visibleProjects = projects.slice(visibleRange.start, visibleRange.end);

  return (
    <div className="project-list" onScroll={handleScroll}>
      {visibleProjects.map(project => (
        <ProjectItem key={project.id} project={project} />
      ))}
    </div>
  );
};
```

#### ç¼“å­˜ç­–ç•¥
```typescript
// Service Worker ç¼“å­˜
self.addEventListener('fetch', (event) => {
  if (event.request.url.includes('/vendors/')) {
    event.respondWith(
      caches.open('livecodes-vendors').then(cache => {
        return cache.match(event.request).then(response => {
          return response || fetch(event.request).then(fetchResponse => {
            cache.put(event.request, fetchResponse.clone());
            return fetchResponse;
          });
        });
      })
    );
  }
});
```

## å¼€å‘æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡åŸåˆ™

#### æ¨¡å—åŒ–è®¾è®¡
- æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼ŒèŒè´£å•ä¸€
- ä½¿ç”¨ TypeScript æ¥å£å®šä¹‰æ¨¡å—è¾¹ç•Œ
- ä¾èµ–æ³¨å…¥å‡å°‘æ¨¡å—é—´è€¦åˆ

#### æ–‡ä»¶å‘½åè§„èŒƒ
```
src/livecodes/
â”œâ”€â”€ languages/
â”‚   â”œâ”€â”€ typescript/
â”‚   â”‚   â”œâ”€â”€ lang-typescript.ts          # è¯­è¨€å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ lang-typescript-compiler.ts # ç¼–è¯‘å™¨å®ç°
â”‚   â”‚   â””â”€â”€ __tests__/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ index.ts                        # å¯¼å‡ºæ–‡ä»¶
```

### 2. ç±»å‹å®‰å…¨

#### ä¸¥æ ¼çš„ TypeScript é…ç½®
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

#### è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥
```typescript
const validateConfig = (config: unknown): config is Config => {
  return (
    typeof config === 'object' &&
    config !== null &&
    'markup' in config &&
    'style' in config &&
    'script' in config
  );
};
```

### 3. é”™è¯¯å¤„ç†

#### ç»Ÿä¸€é”™è¯¯å¤„ç†
```typescript
class LiveCodesError extends Error {
  constructor(
    message: string,
    public code: string,
    public context?: any
  ) {
    super(message);
    this.name = 'LiveCodesError';
  }
}

const handleError = (error: Error, context: string) => {
  console.error(`Error in ${context}:`, error);

  // å‘é€é”™è¯¯æŠ¥å‘Š
  if (process.env.NODE_ENV === 'production') {
    sendErrorReport(error, context);
  }

  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
  notifications.error(getErrorMessage(error));
};
```

### 4. å¯è®¿é—®æ€§

#### é”®ç›˜å¯¼èˆª
```typescript
const handleKeyboardNavigation = (event: KeyboardEvent) => {
  switch (event.key) {
    case 'F5':
      event.preventDefault();
      runCode();
      break;
    case 'F8':
      event.preventDefault();
      formatCode();
      break;
    // ... æ›´å¤šå¿«æ·é”®
  }
};
```

#### ARIA æ ‡ç­¾
```html
<button
  aria-label="Run code (F5)"
  aria-describedby="run-button-description"
  onClick={runCode}
>
  Run
</button>
<div id="run-button-description" className="sr-only">
  Executes the current code and displays the result
</div>
```

## éƒ¨ç½²å’Œè¿ç»´

### 1. æ„å»ºä¼˜åŒ–

#### ç”Ÿäº§æ„å»ºé…ç½®
```javascript
// esbuild é…ç½®
const buildConfig = {
  entryPoints: ['src/livecodes/main.ts'],
  bundle: true,
  minify: true,
  sourcemap: false,
  target: 'es2020',
  format: 'esm',
  splitting: true,
  chunkNames: 'chunks/[name]-[hash]',
  define: {
    'process.env.NODE_ENV': '"production"',
    'process.env.VERSION': `"${version}"`,
  },
};
```

#### èµ„æºä¼˜åŒ–
```javascript
// å›¾ç‰‡å‹ç¼©å’Œæ ¼å¼è½¬æ¢
const optimizeImages = async () => {
  const images = await glob('src/assets/**/*.{png,jpg,jpeg}');

  for (const image of images) {
    await sharp(image)
      .resize(800, 600, { fit: 'inside', withoutEnlargement: true })
      .webp({ quality: 80 })
      .toFile(image.replace(/\.(png|jpg|jpeg)$/, '.webp'));
  }
};
```

### 2. ç›‘æ§å’Œåˆ†æ

#### æ€§èƒ½ç›‘æ§
```typescript
// æ€§èƒ½æŒ‡æ ‡æ”¶é›†
const collectPerformanceMetrics = () => {
  const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;

  const metrics = {
    loadTime: navigation.loadEventEnd - navigation.fetchStart,
    domContentLoaded: navigation.domContentLoadedEventEnd - navigation.fetchStart,
    firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime,
    firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime,
  };

  // å‘é€åˆ°åˆ†ææœåŠ¡
  sendAnalytics('performance', metrics);
};
```

#### é”™è¯¯ç›‘æ§
```typescript
// å…¨å±€é”™è¯¯æ•è·
window.addEventListener('error', (event) => {
  sendErrorReport({
    message: event.message,
    filename: event.filename,
    lineno: event.lineno,
    colno: event.colno,
    stack: event.error?.stack,
  });
});

window.addEventListener('unhandledrejection', (event) => {
  sendErrorReport({
    message: 'Unhandled Promise Rejection',
    reason: event.reason,
  });
});
```

## å­¦ä¹ å’Œå®è·µå»ºè®®

### 1. å¦‚ä½•å­¦ä¹ è¿™ä¸ªé¡¹ç›®

#### å­¦ä¹ è·¯å¾„
1. **åŸºç¡€ç†è§£**
   - é˜…è¯» README å’Œæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚å†µ
   - è¿è¡Œé¡¹ç›®ï¼Œä½“éªŒæ ¸å¿ƒåŠŸèƒ½
   - æŸ¥çœ‹é¡¹ç›®ç»“æ„ï¼Œç†è§£æ¨¡å—åˆ’åˆ†

2. **æ ¸å¿ƒæ¦‚å¿µ**
   - ç†è§£ç¼–è¯‘å™¨ç³»ç»Ÿçš„è®¾è®¡æ€è·¯
   - å­¦ä¹ è¯­è¨€æ”¯æŒçš„å®ç°æœºåˆ¶
   - æŒæ¡ SDK çš„é€šä¿¡åŸç†

3. **æ·±å…¥æºç **
   - ä» `main.ts` å¼€å§‹ï¼Œè·Ÿè¸ªä»£ç æ‰§è¡Œæµç¨‹
   - åˆ†æç¼–è¯‘å™¨çš„åŠ è½½å’Œæ‰§è¡Œè¿‡ç¨‹
   - ç ”ç©¶ SDK çš„å®ç°ç»†èŠ‚

4. **å®è·µæ‰©å±•**
   - å°è¯•æ·»åŠ æ–°çš„è¯­è¨€æ”¯æŒ
   - å®ç°è‡ªå®šä¹‰ç¼–è¾‘å™¨æ’ä»¶
   - å¼€å‘æ–°çš„åŠŸèƒ½æ¨¡å—

#### å…³é”®æ–‡ä»¶å­¦ä¹ é¡ºåº
```
1. src/livecodes/main.ts          # å…¥å£æ–‡ä»¶
2. src/livecodes/core.ts          # æ ¸å¿ƒé€»è¾‘
3. src/livecodes/compiler/        # ç¼–è¯‘å™¨ç³»ç»Ÿ
4. src/livecodes/languages/       # è¯­è¨€æ”¯æŒ
5. src/sdk/                       # SDK å®ç°
6. src/livecodes/editor/          # ç¼–è¾‘å™¨é›†æˆ
```

### 2. æ„å»ºç±»ä¼¼é¡¹ç›®çš„æŒ‡å—

#### æŠ€æœ¯é€‰å‹å»ºè®®
```typescript
// æ¨èçš„æŠ€æœ¯æ ˆ
const recommendedStack = {
  // å‰ç«¯æ¡†æ¶
  frontend: 'TypeScript + ESBuild',

  // ç¼–è¾‘å™¨
  editor: 'Monaco Editor æˆ– CodeMirror 6',

  // ç¼–è¯‘å™¨
  compiler: 'Web Workers + WebAssembly',

  // æ„å»ºå·¥å…·
  build: 'ESBuild æˆ– Vite',

  // æµ‹è¯•æ¡†æ¶
  testing: 'Jest + Playwright',

  // éƒ¨ç½²å¹³å°
  deployment: 'Cloudflare Pages æˆ– Vercel',
};
```

#### æ¶æ„è®¾è®¡åŸåˆ™
1. **æ¨¡å—åŒ–è®¾è®¡**
   - æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—
   - æ¸…æ™°çš„æ¥å£å®šä¹‰
   - æœ€å°åŒ–æ¨¡å—é—´ä¾èµ–

2. **å¯æ‰©å±•æ€§**
   - æ’ä»¶åŒ–çš„è¯­è¨€æ”¯æŒ
   - å¯é…ç½®çš„ç¼–è¯‘å™¨
   - çµæ´»çš„ UI ç»„ä»¶

3. **æ€§èƒ½ä¼˜åŒ–**
   - æŒ‰éœ€åŠ è½½èµ„æº
   - Web Workers å¤„ç†é‡ä»»åŠ¡
   - æ™ºèƒ½ç¼“å­˜æœºåˆ¶

#### æ ¸å¿ƒåŠŸèƒ½å®ç°æ­¥éª¤

##### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶
```typescript
// 1. åˆ›å»ºåŸºç¡€é¡¹ç›®ç»“æ„
const projectStructure = {
  'src/': {
    'core/': 'æ ¸å¿ƒé€»è¾‘',
    'editor/': 'ç¼–è¾‘å™¨é›†æˆ',
    'compiler/': 'ç¼–è¯‘å™¨ç³»ç»Ÿ',
    'ui/': 'ç”¨æˆ·ç•Œé¢',
    'utils/': 'å·¥å…·å‡½æ•°',
  },
  'tests/': 'æµ‹è¯•æ–‡ä»¶',
  'docs/': 'æ–‡æ¡£',
};

// 2. å®ç°åŸºç¡€ç¼–è¾‘å™¨
const createBasicEditor = async () => {
  const monaco = await import('monaco-editor');
  return monaco.editor.create(container, {
    value: 'console.log("Hello World");',
    language: 'javascript',
  });
};

// 3. å®ç°åŸºç¡€ç¼–è¯‘å™¨
const createBasicCompiler = () => ({
  compile: async (code: string, language: string) => {
    switch (language) {
      case 'javascript':
        return code; // ç›´æ¥è¿”å›
      case 'typescript':
        return transpileTypeScript(code);
      default:
        throw new Error(`Unsupported language: ${language}`);
    }
  },
});
```

##### ç¬¬äºŒé˜¶æ®µï¼šè¯­è¨€æ”¯æŒ
```typescript
// 1. å®šä¹‰è¯­è¨€è§„èŒƒæ¥å£
interface LanguageSpec {
  name: string;
  title: string;
  extensions: string[];
  compiler: CompilerConfig;
  editor: 'markup' | 'style' | 'script';
}

// 2. å®ç°è¯­è¨€æ³¨å†Œç³»ç»Ÿ
class LanguageRegistry {
  private languages = new Map<string, LanguageSpec>();

  register(spec: LanguageSpec) {
    this.languages.set(spec.name, spec);
  }

  get(name: string): LanguageSpec | undefined {
    return this.languages.get(name);
  }

  getAll(): LanguageSpec[] {
    return Array.from(this.languages.values());
  }
}

// 3. æ·»åŠ æ–°è¯­è¨€æ”¯æŒ
const addPythonSupport = () => {
  registry.register({
    name: 'python',
    title: 'Python',
    extensions: ['py'],
    compiler: {
      type: 'wasm',
      url: 'https://cdn.jsdelivr.net/pyodide/pyodide.js',
    },
    editor: 'script',
  });
};
```

##### ç¬¬ä¸‰é˜¶æ®µï¼šSDK å¼€å‘
```typescript
// 1. å®šä¹‰ API æ¥å£
interface PlaygroundAPI {
  run(): Promise<void>;
  getCode(): Promise<string>;
  setCode(code: string): Promise<void>;
  getConfig(): Promise<Config>;
  setConfig(config: Partial<Config>): Promise<void>;
}

// 2. å®ç°é€šä¿¡æœºåˆ¶
class PlaygroundSDK implements PlaygroundAPI {
  private iframe: HTMLIFrameElement;

  constructor(container: string | HTMLElement) {
    this.iframe = this.createIframe(container);
  }

  private async callAPI<T>(method: string, args?: any[]): Promise<T> {
    return new Promise((resolve, reject) => {
      const id = Math.random().toString(36);

      const handler = (event: MessageEvent) => {
        if (event.data.id === id) {
          window.removeEventListener('message', handler);
          if (event.data.error) {
            reject(new Error(event.data.error));
          } else {
            resolve(event.data.result);
          }
        }
      };

      window.addEventListener('message', handler);
      this.iframe.contentWindow?.postMessage({ method, args, id }, '*');
    });
  }

  async run(): Promise<void> {
    return this.callAPI('run');
  }

  async getCode(): Promise<string> {
    return this.callAPI('getCode');
  }
}

// 3. åˆ›å»º React ç»„ä»¶
const LiveCodesPlayground: React.FC<PlaygroundProps> = ({ config, onReady }) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [playground, setPlayground] = useState<PlaygroundAPI | null>(null);

  useEffect(() => {
    if (containerRef.current) {
      const sdk = new PlaygroundSDK(containerRef.current);
      setPlayground(sdk);
      onReady?.(sdk);
    }
  }, [onReady]);

  return <div ref={containerRef} style={{ width: '100%', height: '400px' }} />;
};
```

### 3. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### æ€§èƒ½é—®é¢˜
```typescript
// é—®é¢˜ï¼šç¼–è¯‘å™¨åŠ è½½æ…¢
// è§£å†³ï¼šæ‡’åŠ è½½ + é¢„åŠ è½½
const preloadCompilers = async (languages: string[]) => {
  const promises = languages.map(lang =>
    import(`./compilers/${lang}`).catch(() => null)
  );
  await Promise.allSettled(promises);
};

// é—®é¢˜ï¼šå¤§æ–‡ä»¶ç¼–è¯‘å¡é¡¿
// è§£å†³ï¼šWeb Workers + åˆ†ç‰‡å¤„ç†
const compileInChunks = async (code: string, chunkSize = 1000) => {
  const chunks = [];
  for (let i = 0; i < code.length; i += chunkSize) {
    chunks.push(code.slice(i, i + chunkSize));
  }

  const results = await Promise.all(
    chunks.map(chunk => compileInWorker(chunk))
  );

  return results.join('');
};
```

#### å…¼å®¹æ€§é—®é¢˜
```typescript
// é—®é¢˜ï¼šæµè§ˆå™¨å…¼å®¹æ€§
// è§£å†³ï¼šç‰¹æ€§æ£€æµ‹ + Polyfill
const checkBrowserSupport = () => {
  const features = {
    webWorkers: typeof Worker !== 'undefined',
    webAssembly: typeof WebAssembly !== 'undefined',
    es6Modules: 'noModule' in HTMLScriptElement.prototype,
  };

  const unsupported = Object.entries(features)
    .filter(([, supported]) => !supported)
    .map(([feature]) => feature);

  if (unsupported.length > 0) {
    throw new Error(`Unsupported features: ${unsupported.join(', ')}`);
  }
};

// é—®é¢˜ï¼šç§»åŠ¨ç«¯é€‚é…
// è§£å†³ï¼šå“åº”å¼è®¾è®¡ + è§¦æ‘¸ä¼˜åŒ–
const setupMobileOptimizations = () => {
  if (isMobile()) {
    // è°ƒæ•´ç¼–è¾‘å™¨é…ç½®
    editorConfig.fontSize = 14;
    editorConfig.lineHeight = 1.5;

    // å¯ç”¨è§¦æ‘¸æ‰‹åŠ¿
    enableTouchGestures();

    // ä¼˜åŒ–è™šæ‹Ÿé”®ç›˜
    setupVirtualKeyboard();
  }
};
```

### 4. æ‰©å±•å’Œå®šåˆ¶

#### æ·»åŠ æ–°è¯­è¨€æ”¯æŒ
```typescript
// 1. åˆ›å»ºè¯­è¨€å®šä¹‰æ–‡ä»¶
// src/languages/mylang/lang-mylang.ts
export const mylang: LanguageSpecs = {
  name: 'mylang',
  title: 'MyLang',
  compiler: {
    factory: () => async (code) => {
      // å®ç°ç¼–è¯‘é€»è¾‘
      return compileMyLang(code);
    },
  },
  extensions: ['ml'],
  editor: 'script',
};

// 2. æ³¨å†Œè¯­è¨€
// src/languages/index.ts
import { mylang } from './mylang/lang-mylang';

export const languages = [
  // ... å…¶ä»–è¯­è¨€
  mylang,
];
```

#### è‡ªå®šä¹‰ä¸»é¢˜
```typescript
// 1. å®šä¹‰ä¸»é¢˜æ¥å£
interface Theme {
  name: string;
  colors: {
    background: string;
    foreground: string;
    accent: string;
    // ... æ›´å¤šé¢œè‰²
  };
  editor: {
    background: string;
    foreground: string;
    // ... ç¼–è¾‘å™¨æ ·å¼
  };
}

// 2. å®ç°ä¸»é¢˜åˆ‡æ¢
const applyTheme = (theme: Theme) => {
  // åº”ç”¨ CSS å˜é‡
  Object.entries(theme.colors).forEach(([key, value]) => {
    document.documentElement.style.setProperty(`--color-${key}`, value);
  });

  // æ›´æ–°ç¼–è¾‘å™¨ä¸»é¢˜
  monaco.editor.defineTheme('custom', {
    base: 'vs-dark',
    inherit: true,
    rules: [],
    colors: theme.editor,
  });

  monaco.editor.setTheme('custom');
};
```

## æ€»ç»“

LiveCodes é¡¹ç›®å±•ç¤ºäº†ç°ä»£ Web åº”ç”¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œå…¶æ¶æ„è®¾è®¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### æŠ€æœ¯äº®ç‚¹
1. **åˆ›æ–°çš„å®¢æˆ·ç«¯ç¼–è¯‘æ¶æ„**ï¼šå®Œå…¨åœ¨æµè§ˆå™¨ä¸­å®ç°å¤šè¯­è¨€ç¼–è¯‘
2. **æ¨¡å—åŒ–çš„è¯­è¨€æ”¯æŒç³»ç»Ÿ**ï¼šç»Ÿä¸€æ¥å£ï¼Œæ˜“äºæ‰©å±•
3. **å¼ºå¤§çš„ SDK è®¾è®¡**ï¼šæ”¯æŒå¤šæ¡†æ¶ï¼Œé€šä¿¡æœºåˆ¶å®Œå–„
4. **ä¼˜ç§€çš„æ€§èƒ½ä¼˜åŒ–**ï¼šWeb Workersã€ç¼“å­˜ã€æŒ‰éœ€åŠ è½½
5. **å®Œå–„çš„å¼€å‘ä½“éªŒ**ï¼šTypeScriptã€æµ‹è¯•ã€æ–‡æ¡£

### å­¦ä¹ ä»·å€¼
- **æ¶æ„è®¾è®¡æ€ç»´**ï¼šå¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„å¤§å‹å‰ç«¯åº”ç”¨
- **ç¼–è¯‘å™¨æŠ€æœ¯**ï¼šWeb ç«¯ç¼–è¯‘å™¨çš„å®ç°åŸç†
- **SDK å¼€å‘**ï¼šå¦‚ä½•è®¾è®¡æ˜“ç”¨çš„å¼€å‘è€…å·¥å…·
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§å‹åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **å·¥ç¨‹åŒ–å®è·µ**ï¼šç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„æœ€ä½³å®è·µ

### åº”ç”¨åœºæ™¯
- åœ¨çº¿ä»£ç ç¼–è¾‘å™¨
- æ•™è‚²å¹³å°çš„ç¼–ç¨‹ç¯å¢ƒ
- æŠ€æœ¯æ–‡æ¡£çš„äº¤äº’å¼ç¤ºä¾‹
- åŸå‹å¼€å‘å·¥å…·
- ä»£ç åˆ†äº«å¹³å°

è¿™ä¸ªé¡¹ç›®ä¸ºæ„å»ºç±»ä¼¼çš„åœ¨çº¿å¼€å‘ç¯å¢ƒæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆå’Œå®è´µçš„ç»éªŒï¼Œå€¼å¾—æ·±å…¥å­¦ä¹ å’Œå€Ÿé‰´ã€‚é€šè¿‡åˆ†æ LiveCodes çš„æ¶æ„è®¾è®¡å’Œå®ç°ç»†èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å¦‚ä½•æ„å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½ä¼˜ç§€ã€æ˜“äºæ‰©å±•çš„ç°ä»£ Web åº”ç”¨ã€‚
```
