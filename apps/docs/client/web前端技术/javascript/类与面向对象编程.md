# JavaScriptç±»ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹

JavaScriptè™½ç„¶æ˜¯ä¸€ç§åŸºäºåŸå‹çš„è¯­è¨€ï¼Œä½†ES6å¼•å…¥çš„classè¯­æ³•ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹æä¾›äº†æ›´ç›´è§‚çš„æ–¹å¼ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨JavaScriptä¸­çš„ç±»ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹æ¦‚å¿µå’Œå®è·µã€‚

## é¢å‘å¯¹è±¡ç¼–ç¨‹åŸºç¡€

### ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹

é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå°†ç°å®ä¸–ç•Œçš„æ¦‚å¿µæŠ½è±¡ä¸ºå¯¹è±¡ï¼Œå¼ºè°ƒï¼š

- **å°è£…**ï¼šå°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·
- **ç»§æ‰¿**ï¼šå­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•
- **å¤šæ€**ï¼šåŒä¸€æ¥å£å¯ä»¥æœ‰ä¸åŒçš„å®ç°
- **æŠ½è±¡**ï¼šéšè—å¤æ‚çš„å®ç°ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£

### é¢å‘å¯¹è±¡ä¸å‡½æ•°å¼ç¼–ç¨‹çš„å¯¹æ¯”

é¢å‘å¯¹è±¡ç¼–ç¨‹å…³æ³¨"å¯¹è±¡æ˜¯ä»€ä¹ˆ"ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹å…³æ³¨"åšä»€ä¹ˆ"ï¼š

```javascript
// é¢å‘å¯¹è±¡é£æ ¼ï¼šè®¡ç®—å™¨ç±»
class Calculator {
  constructor() {
    this.result = 0;
  }
  
  add(value) {
    this.result += value;
    return this;
  }
  
  multiply(value) {
    this.result *= value;
    return this;
  }
  
  getResult() {
    return this.result;
  }
}

const calc = new Calculator();
const result = calc.add(5).multiply(2).getResult(); // 10

// å‡½æ•°å¼é£æ ¼ï¼šçº¯å‡½æ•°ç»„åˆ
const add = (a, b) => a + b;
const multiply = (a, b) => a * b;
const pipe = (...fns) => x => fns.reduce((acc, fn) => fn(acc), x);

const calculate = pipe(
  x => add(x, 5),
  x => multiply(x, 2)
);
const result = calculate(0); // 10
```

## ç±»çš„åŸºç¡€è¯­æ³•

### ç±»å£°æ˜ä¸ç±»è¡¨è¾¾å¼

JavaScriptæä¾›äº†ä¸¤ç§å®šä¹‰ç±»çš„æ–¹å¼ï¼š

```javascript
// ç±»å£°æ˜
class Person {
  constructor(name, age) {
    this.name = name;
    this.age = age;
  }
  
  greet() {
    return `ä½ å¥½ï¼Œæˆ‘æ˜¯${this.name}ï¼Œä»Šå¹´${this.age}å²`;
  }
}

// ç±»è¡¨è¾¾å¼
const Animal = class {
  constructor(species) {
    this.species = species;
  }
  
  makeSound() {
    return `${this.species}å‘å‡ºäº†å£°éŸ³`;
  }
};

// å‘½åç±»è¡¨è¾¾å¼
const Vehicle = class Car {
  constructor(brand) {
    this.brand = brand;
  }
  
  start() {
    return `${this.brand}æ±½è½¦å¯åŠ¨äº†`;
  }
};
```

ç±»å£°æ˜ä¸å‡½æ•°å£°æ˜çš„åŒºåˆ«ï¼š
- ç±»å£°æ˜ä¸ä¼šè¢«æå‡ï¼ˆhoistingï¼‰
- ç±»å£°æ˜ä¼šè‡ªåŠ¨å¯ç”¨ä¸¥æ ¼æ¨¡å¼
- ç±»çš„æ–¹æ³•ä¸å¯æšä¸¾

### æ„é€ å‡½æ•°ä¸å®ä¾‹åŒ–

æ„é€ å‡½æ•°æ˜¯ç±»çš„ç‰¹æ®Šæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå’Œåˆå§‹åŒ–å¯¹è±¡å®ä¾‹ï¼š

```javascript
class User {
  constructor(username, email) {
    // å®ä¾‹å±æ€§
    this.username = username;
    this.email = email;
    this.createdAt = new Date();
    this.isActive = true;
    
    // å‚æ•°éªŒè¯
    if (!username || !email) {
      throw new Error('ç”¨æˆ·åå’Œé‚®ç®±ä¸èƒ½ä¸ºç©º');
    }
    
    // åˆå§‹åŒ–é€»è¾‘
    this.id = this.generateId();
  }
  
  generateId() {
    return Math.random().toString(36).substr(2, 9);
  }
  
  getProfile() {
    return {
      id: this.id,
      username: this.username,
      email: this.email,
      createdAt: this.createdAt,
      isActive: this.isActive
    };
  }
}

// åˆ›å»ºå®ä¾‹
const user1 = new User('å¼ ä¸‰', 'zhangsan@example.com');
const user2 = new User('æå››', 'lisi@example.com');

console.log(user1.getProfile());
console.log(user2.getProfile());
```

### å®ä¾‹æ–¹æ³•ä¸åŸå‹

ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ä¼šè¢«æ·»åŠ åˆ°ç±»çš„åŸå‹ä¸Šï¼š

```javascript
class Counter {
  constructor(initialValue = 0) {
    this.value = initialValue;
  }
  
  // å®ä¾‹æ–¹æ³•
  increment() {
    this.value++;
    return this;
  }
  
  decrement() {
    this.value--;
    return this;
  }
  
  reset() {
    this.value = 0;
    return this;
  }
  
  getValue() {
    return this.value;
  }
}

const counter = new Counter(5);

// æ–¹æ³•é“¾è°ƒç”¨
counter.increment().increment().decrement();
console.log(counter.getValue()); // 6

// éªŒè¯æ–¹æ³•åœ¨åŸå‹ä¸Š
console.log(Counter.prototype.increment); // [Function: increment]
console.log(counter.hasOwnProperty('increment')); // false
console.log(counter.hasOwnProperty('value')); // true
```

## ç±»çš„é«˜çº§ç‰¹æ€§

### é™æ€æ–¹æ³•ä¸é™æ€å±æ€§

é™æ€æˆå‘˜å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹ï¼š

```javascript
class MathUtils {
  // é™æ€å±æ€§
  static PI = 3.14159;
  static E = 2.71828;
  
  // é™æ€æ–¹æ³•
  static add(a, b) {
    return a + b;
  }
  
  static multiply(a, b) {
    return a * b;
  }
  
  static circleArea(radius) {
    return this.PI * radius * radius;
  }
  
  static factorial(n) {
    if (n <= 1) return 1;
    return n * this.factorial(n - 1);
  }
}

// ä½¿ç”¨é™æ€æˆå‘˜
console.log(MathUtils.PI); // 3.14159
console.log(MathUtils.add(5, 3)); // 8
console.log(MathUtils.circleArea(5)); // 78.53975
console.log(MathUtils.factorial(5)); // 120

// é™æ€æ–¹æ³•ä¸èƒ½é€šè¿‡å®ä¾‹è°ƒç”¨
const math = new MathUtils();
// console.log(math.add(1, 2)); // TypeError: math.add is not a function
```

å®é™…åº”ç”¨åœºæ™¯ï¼š

```javascript
class User {
  constructor(username, email) {
    this.username = username;
    this.email = email;
    this.id = User.generateId();
  }
  
  // é™æ€æ–¹æ³•ï¼šå·¥å‚æ–¹æ³•
  static createAdmin(username, email) {
    const admin = new User(username, email);
    admin.role = 'admin';
    admin.permissions = ['read', 'write', 'delete'];
    return admin;
  }
  
  static createGuest() {
    const guest = new User('guest', 'guest@example.com');
    guest.role = 'guest';
    guest.permissions = ['read'];
    return guest;
  }
  
  // é™æ€æ–¹æ³•ï¼šå·¥å…·æ–¹æ³•
  static generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
  }
  
  static validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
  
  // é™æ€æ–¹æ³•ï¼šæŸ¥æ‰¾æ–¹æ³•
  static findById(users, id) {
    return users.find(user => user.id === id);
  }
}

// ä½¿ç”¨å·¥å‚æ–¹æ³•
const admin = User.createAdmin('admin', 'admin@example.com');
const guest = User.createGuest();

console.log(admin.role); // 'admin'
console.log(guest.permissions); // ['read']

// ä½¿ç”¨å·¥å…·æ–¹æ³•
console.log(User.validateEmail('test@example.com')); // true
console.log(User.validateEmail('invalid-email')); // false
```

### è®¿é—®å™¨å±æ€§ï¼ˆGetter/Setterï¼‰

è®¿é—®å™¨å±æ€§å…è®¸æˆ‘ä»¬å®šä¹‰çœ‹èµ·æ¥åƒå±æ€§ä½†å®é™…ä¸Šæ˜¯æ–¹æ³•çš„æˆå‘˜ï¼š

```javascript
class Temperature {
  constructor(celsius = 0) {
    this._celsius = celsius;
  }
  
  // Getterï¼šè·å–æ‘„æ°åº¦
  get celsius() {
    return this._celsius;
  }
  
  // Setterï¼šè®¾ç½®æ‘„æ°åº¦
  set celsius(value) {
    if (typeof value !== 'number') {
      throw new Error('æ¸©åº¦å¿…é¡»æ˜¯æ•°å­—');
    }
    if (value < -273.15) {
      throw new Error('æ¸©åº¦ä¸èƒ½ä½äºç»å¯¹é›¶åº¦');
    }
    this._celsius = value;
  }
  
  // Getterï¼šè·å–åæ°åº¦
  get fahrenheit() {
    return this._celsius * 9/5 + 32;
  }
  
  // Setterï¼šè®¾ç½®åæ°åº¦
  set fahrenheit(value) {
    this.celsius = (value - 32) * 5/9;
  }
  
  // Getterï¼šè·å–å¼€å°”æ–‡æ¸©åº¦
  get kelvin() {
    return this._celsius + 273.15;
  }
  
  // Setterï¼šè®¾ç½®å¼€å°”æ–‡æ¸©åº¦
  set kelvin(value) {
    this.celsius = value - 273.15;
  }
  
  toString() {
    return `${this._celsius}Â°C (${this.fahrenheit}Â°F, ${this.kelvin}K)`;
  }
}

const temp = new Temperature(25);
console.log(temp.toString()); // "25Â°C (77Â°F, 298.15K)"

// é€šè¿‡ä¸åŒå•ä½è®¾ç½®æ¸©åº¦
temp.fahrenheit = 100;
console.log(temp.celsius); // 37.77777777777778

temp.kelvin = 300;
console.log(temp.celsius); // 26.850000000000023
```

è®¿é—®å™¨çš„å®é™…åº”ç”¨ï¼š

```javascript
class BankAccount {
  constructor(accountNumber, initialBalance = 0) {
    this.accountNumber = accountNumber;
    this._balance = initialBalance;
    this._transactions = [];
  }
  
  // åªè¯»å±æ€§
  get balance() {
    return this._balance;
  }
  
  get transactions() {
    return [...this._transactions]; // è¿”å›å‰¯æœ¬ï¼Œé˜²æ­¢å¤–éƒ¨ä¿®æ”¹
  }
  
  // è®¡ç®—å±æ€§
  get totalDeposits() {
    return this._transactions
      .filter(t => t.type === 'deposit')
      .reduce((sum, t) => sum + t.amount, 0);
  }
  
  get totalWithdrawals() {
    return this._transactions
      .filter(t => t.type === 'withdrawal')
      .reduce((sum, t) => sum + t.amount, 0);
  }
  
  deposit(amount) {
    if (amount <= 0) {
      throw new Error('å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0');
    }
    this._balance += amount;
    this._transactions.push({
      type: 'deposit',
      amount,
      date: new Date(),
      balance: this._balance
    });
  }
  
  withdraw(amount) {
    if (amount <= 0) {
      throw new Error('å–æ¬¾é‡‘é¢å¿…é¡»å¤§äº0');
    }
    if (amount > this._balance) {
      throw new Error('ä½™é¢ä¸è¶³');
    }
    this._balance -= amount;
    this._transactions.push({
      type: 'withdrawal',
      amount,
      date: new Date(),
      balance: this._balance
    });
  }
}

const account = new BankAccount('123456789', 1000);
account.deposit(500);
account.withdraw(200);

console.log(account.balance); // 1300
console.log(account.totalDeposits); // 500
console.log(account.totalWithdrawals); // 200
```

### ç§æœ‰å­—æ®µå’Œæ–¹æ³•

ç°ä»£æµè§ˆå™¨æ”¯æŒçœŸæ­£çš„ç§æœ‰å­—æ®µå’Œæ–¹æ³•ï¼Œä½¿ç”¨`#`å‰ç¼€ï¼š

```javascript
class SecureWallet {
  // ç§æœ‰å­—æ®µ
  #balance = 0;
  #pin;
  #attempts = 0;
  #maxAttempts = 3;
  #locked = false;

  constructor(initialBalance, pin) {
    this.#balance = initialBalance;
    this.#pin = pin;
  }

  // ç§æœ‰æ–¹æ³•
  #validatePin(inputPin) {
    if (this.#locked) {
      throw new Error('é’±åŒ…å·²è¢«é”å®š');
    }

    if (inputPin !== this.#pin) {
      this.#attempts++;
      if (this.#attempts >= this.#maxAttempts) {
        this.#locked = true;
        throw new Error('é’±åŒ…å·²è¢«é”å®šï¼Œå°è¯•æ¬¡æ•°è¿‡å¤š');
      }
      throw new Error(`PINé”™è¯¯ï¼Œè¿˜æœ‰${this.#maxAttempts - this.#attempts}æ¬¡æœºä¼š`);
    }

    this.#attempts = 0; // é‡ç½®å°è¯•æ¬¡æ•°
  }

  #log(action, amount) {
    console.log(`[${new Date().toISOString()}] ${action}: ${amount}, ä½™é¢: ${this.#balance}`);
  }

  // å…¬æœ‰æ–¹æ³•
  getBalance(pin) {
    this.#validatePin(pin);
    return this.#balance;
  }

  deposit(amount, pin) {
    this.#validatePin(pin);
    if (amount <= 0) {
      throw new Error('å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0');
    }
    this.#balance += amount;
    this.#log('å­˜æ¬¾', amount);
  }

  withdraw(amount, pin) {
    this.#validatePin(pin);
    if (amount <= 0) {
      throw new Error('å–æ¬¾é‡‘é¢å¿…é¡»å¤§äº0');
    }
    if (amount > this.#balance) {
      throw new Error('ä½™é¢ä¸è¶³');
    }
    this.#balance -= amount;
    this.#log('å–æ¬¾', amount);
  }

  changePin(oldPin, newPin) {
    this.#validatePin(oldPin);
    this.#pin = newPin;
    console.log('PINå·²æ›´æ”¹');
  }

  unlock(masterKey) {
    if (masterKey === 'MASTER_RESET_2024') {
      this.#locked = false;
      this.#attempts = 0;
      console.log('é’±åŒ…å·²è§£é”');
    } else {
      throw new Error('ä¸»å¯†é’¥é”™è¯¯');
    }
  }
}

const wallet = new SecureWallet(1000, '1234');

// æ­£å¸¸æ“ä½œ
wallet.deposit(500, '1234');
console.log(wallet.getBalance('1234')); // 1500

// ç§æœ‰å­—æ®µæ— æ³•ä»å¤–éƒ¨è®¿é—®
// console.log(wallet.#balance); // SyntaxError

try {
  wallet.getBalance('0000');
} catch (error) {
  console.log(error.message);
}
```

ç§æœ‰å­—æ®µçš„ç‰¹ç‚¹ï¼š
- åªèƒ½åœ¨ç±»å†…éƒ¨è®¿é—®
- ä¸ä¼šè¢«ç»§æ‰¿
- ä¸èƒ½åŠ¨æ€æ·»åŠ 
- æä¾›çœŸæ­£çš„å°è£…

### ç±»å­—æ®µå£°æ˜

ç°ä»£JavaScriptå…è®¸ç›´æ¥åœ¨ç±»ä½“ä¸­å£°æ˜å­—æ®µï¼š

```javascript
class GameCharacter {
  // å…¬æœ‰å­—æ®µ
  name = 'æœªå‘½åè§’è‰²';
  level = 1;
  experience = 0;

  // ç§æœ‰å­—æ®µ
  #health = 100;
  #maxHealth = 100;
  #mana = 50;
  #maxMana = 50;

  // é™æ€å­—æ®µ
  static maxLevel = 100;
  static experienceTable = [0, 100, 300, 600, 1000];

  constructor(name, characterClass = 'warrior') {
    this.name = name;
    this.characterClass = characterClass;
    this.skills = this.#getInitialSkills(characterClass);
  }

  #getInitialSkills(characterClass) {
    const skillSets = {
      warrior: ['å‰‘æœ¯', 'ç›¾ç‰Œé˜²å¾¡'],
      mage: ['ç«çƒæœ¯', 'æ²»ç–—æœ¯'],
      archer: ['ç²¾å‡†å°„å‡»', 'å¿«é€Ÿç§»åŠ¨']
    };
    return skillSets[characterClass] || skillSets.warrior;
  }

  // Getter for health percentage
  get healthPercentage() {
    return (this.#health / this.#maxHealth) * 100;
  }

  get isAlive() {
    return this.#health > 0;
  }

  takeDamage(damage) {
    this.#health = Math.max(0, this.#health - damage);
    console.log(`${this.name}å—åˆ°${damage}ç‚¹ä¼¤å®³ï¼Œå‰©ä½™ç”Ÿå‘½å€¼ï¼š${this.#health}`);

    if (!this.isAlive) {
      console.log(`${this.name}å·²æ­»äº¡`);
    }
  }

  heal(amount) {
    this.#health = Math.min(this.#maxHealth, this.#health + amount);
    console.log(`${this.name}æ¢å¤${amount}ç‚¹ç”Ÿå‘½å€¼ï¼Œå½“å‰ç”Ÿå‘½å€¼ï¼š${this.#health}`);
  }

  gainExperience(exp) {
    this.experience += exp;
    console.log(`${this.name}è·å¾—${exp}ç‚¹ç»éªŒå€¼`);

    // æ£€æŸ¥æ˜¯å¦å‡çº§
    while (this.level < GameCharacter.maxLevel &&
           this.experience >= GameCharacter.experienceTable[this.level]) {
      this.levelUp();
    }
  }

  levelUp() {
    this.level++;
    this.#maxHealth += 20;
    this.#health = this.#maxHealth; // å‡çº§æ—¶æ¢å¤æ»¡è¡€
    this.#maxMana += 10;
    this.#mana = this.#maxMana;

    console.log(`ğŸ‰ ${this.name}å‡çº§åˆ°${this.level}çº§ï¼`);
  }

  getStatus() {
    return {
      name: this.name,
      class: this.characterClass,
      level: this.level,
      experience: this.experience,
      health: `${this.#health}/${this.#maxHealth}`,
      mana: `${this.#mana}/${this.#maxMana}`,
      skills: this.skills,
      isAlive: this.isAlive
    };
  }
}

const hero = new GameCharacter('äºšç‘Ÿ', 'warrior');
console.log(hero.getStatus());

hero.gainExperience(150);
hero.takeDamage(30);
hero.heal(10);
```

ç§æœ‰å­—æ®µæ³¨æ„äº‹é¡¹ï¼š
- éœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒï¼ˆChrome 74+, Firefox 90+ï¼‰
- Node.js 12+ æ”¯æŒ
- è€ç‰ˆæœ¬æµè§ˆå™¨éœ€è¦Babelè½¬è¯‘
```

## ç»§æ‰¿ä¸å¤šæ€

### åŸºç¡€ç»§æ‰¿

ä½¿ç”¨`extends`å…³é”®å­—å®ç°ç±»çš„ç»§æ‰¿ï¼š

```javascript
// åŸºç±»
class Animal {
  constructor(name, species) {
    this.name = name;
    this.species = species;
    this.energy = 100;
  }

  eat(food) {
    this.energy += 20;
    console.log(`${this.name}åƒäº†${food}ï¼Œèƒ½é‡æ¢å¤åˆ°${this.energy}`);
  }

  sleep() {
    this.energy = 100;
    console.log(`${this.name}ç¡äº†ä¸€è§‰ï¼Œç²¾åŠ›å……æ²›`);
  }

  makeSound() {
    console.log(`${this.name}å‘å‡ºäº†å£°éŸ³`);
  }

  getInfo() {
    return `${this.name}æ˜¯ä¸€åª${this.species}ï¼Œå½“å‰èƒ½é‡ï¼š${this.energy}`;
  }
}

// å­ç±»ï¼šç‹—
class Dog extends Animal {
  constructor(name, breed) {
    super(name, 'ç‹—'); // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.breed = breed;
    this.loyalty = 100;
  }

  // é‡å†™çˆ¶ç±»æ–¹æ³•
  makeSound() {
    console.log(`${this.name}æ±ªæ±ªå«`);
  }

  // æ–°å¢æ–¹æ³•
  fetch() {
    if (this.energy < 20) {
      console.log(`${this.name}å¤ªç´¯äº†ï¼Œéœ€è¦ä¼‘æ¯`);
      return;
    }
    this.energy -= 20;
    console.log(`${this.name}å»æ¡çƒäº†ï¼Œèƒ½é‡é™åˆ°${this.energy}`);
  }

  wagTail() {
    console.log(`${this.name}å¼€å¿ƒåœ°æ‘‡å°¾å·´`);
  }

  // é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œæ·»åŠ é¢å¤–é€»è¾‘
  getInfo() {
    return `${super.getInfo()}ï¼Œå“ç§ï¼š${this.breed}ï¼Œå¿ è¯šåº¦ï¼š${this.loyalty}`;
  }
}

// å­ç±»ï¼šçŒ«
class Cat extends Animal {
  constructor(name, color) {
    super(name, 'çŒ«');
    this.color = color;
    this.independence = 80;
  }

  makeSound() {
    console.log(`${this.name}å–µå–µå«`);
  }

  climb() {
    if (this.energy < 15) {
      console.log(`${this.name}å¤ªç´¯äº†ï¼Œä¸æƒ³çˆ¬æ ‘`);
      return;
    }
    this.energy -= 15;
    console.log(`${this.name}çˆ¬åˆ°äº†æ ‘ä¸Šï¼Œèƒ½é‡é™åˆ°${this.energy}`);
  }

  purr() {
    console.log(`${this.name}æ»¡è¶³åœ°å‘¼å™œå‘¼å™œ`);
  }

  getInfo() {
    return `${super.getInfo()}ï¼Œé¢œè‰²ï¼š${this.color}ï¼Œç‹¬ç«‹æ€§ï¼š${this.independence}`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const dog = new Dog('æ—ºè´¢', 'é‡‘æ¯›');
const cat = new Cat('å’ªå’ª', 'æ©˜è‰²');

// å¤šæ€ç¤ºä¾‹
const animals = [dog, cat];
animals.forEach(animal => {
  animal.makeSound();
  console.log(animal.getInfo());
});

dog.fetch();
dog.wagTail();

cat.climb();
cat.purr();
```

### æŠ½è±¡ç±»æ¨¡æ‹Ÿ

JavaScriptæ²¡æœ‰å†…ç½®çš„æŠ½è±¡ç±»ï¼Œä½†å¯ä»¥é€šè¿‡çº¦å®šå’Œé”™è¯¯æŠ›å‡ºæ¥æ¨¡æ‹Ÿï¼š

```javascript
// æŠ½è±¡åŸºç±»
class Shape {
  constructor(color) {
    if (new.target === Shape) {
      throw new Error('Shapeæ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–');
    }
    this.color = color;
  }

  // æŠ½è±¡æ–¹æ³•ï¼šå­ç±»å¿…é¡»å®ç°
  getArea() {
    throw new Error('getAreaæ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­å®ç°');
  }

  getPerimeter() {
    throw new Error('getPerimeteræ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­å®ç°');
  }

  // å…·ä½“æ–¹æ³•ï¼šå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨
  getColor() {
    return this.color;
  }

  setColor(color) {
    this.color = color;
  }

  describe() {
    return `è¿™æ˜¯ä¸€ä¸ª${this.color}çš„å›¾å½¢ï¼Œé¢ç§¯ä¸º${this.getArea()}ï¼Œå‘¨é•¿ä¸º${this.getPerimeter()}`;
  }
}

// å…·ä½“å­ç±»ï¼šåœ†å½¢
class Circle extends Shape {
  constructor(radius, color) {
    super(color);
    this.radius = radius;
  }

  getArea() {
    return Math.PI * this.radius * this.radius;
  }

  getPerimeter() {
    return 2 * Math.PI * this.radius;
  }
}

// å…·ä½“å­ç±»ï¼šçŸ©å½¢
class Rectangle extends Shape {
  constructor(width, height, color) {
    super(color);
    this.width = width;
    this.height = height;
  }

  getArea() {
    return this.width * this.height;
  }

  getPerimeter() {
    return 2 * (this.width + this.height);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const circle = new Circle(5, 'çº¢è‰²');
const rectangle = new Rectangle(4, 6, 'è“è‰²');

console.log(circle.describe());
console.log(rectangle.describe());

// ç›´æ¥å®ä¾‹åŒ–æŠ½è±¡ç±»ä¼šæŠ¥é”™
// const shape = new Shape('ç»¿è‰²'); // Error
```

### æ¥å£æ¨¡æ‹Ÿ

JavaScriptå¯ä»¥é€šè¿‡æ··å…¥ï¼ˆMixinï¼‰æ¨¡å¼æ¨¡æ‹Ÿæ¥å£ï¼š

```javascript
// å®šä¹‰æ¥å£ï¼ˆæ··å…¥ï¼‰
const Flyable = {
  fly() {
    console.log(`${this.name}åœ¨é£è¡Œ`);
  },

  land() {
    console.log(`${this.name}é™è½äº†`);
  }
};

const Swimmable = {
  swim() {
    console.log(`${this.name}åœ¨æ¸¸æ³³`);
  },

  dive() {
    console.log(`${this.name}æ½œæ°´äº†`);
  }
};

const Walkable = {
  walk() {
    console.log(`${this.name}åœ¨èµ°è·¯`);
  },

  run() {
    console.log(`${this.name}åœ¨è·‘æ­¥`);
  }
};

// æ··å…¥å‡½æ•°
function mixin(target, ...sources) {
  sources.forEach(source => {
    Object.getOwnPropertyNames(source).forEach(name => {
      if (name !== 'constructor') {
        target.prototype[name] = source[name];
      }
    });
  });
}

// åŸºç±»
class Animal {
  constructor(name) {
    this.name = name;
  }
}

// é¸Ÿç±»ï¼šå¯ä»¥é£è¡Œå’Œèµ°è·¯
class Bird extends Animal {
  constructor(name, species) {
    super(name);
    this.species = species;
  }
}
mixin(Bird, Flyable, Walkable);

// é±¼ç±»ï¼šå¯ä»¥æ¸¸æ³³
class Fish extends Animal {
  constructor(name, species) {
    super(name);
    this.species = species;
  }
}
mixin(Fish, Swimmable);

// é¸­å­ï¼šå¯ä»¥é£è¡Œã€æ¸¸æ³³å’Œèµ°è·¯
class Duck extends Animal {
  constructor(name) {
    super(name);
    this.species = 'é¸­å­';
  }
}
mixin(Duck, Flyable, Swimmable, Walkable);

// ä½¿ç”¨ç¤ºä¾‹
const eagle = new Bird('è€é¹°', 'çŒ›ç¦½');
const salmon = new Fish('ä¸‰æ–‡é±¼', 'é²‘é±¼');
const duck = new Duck('å”è€é¸­');

eagle.fly();
eagle.walk();

salmon.swim();
salmon.dive();

duck.fly();
duck.swim();
duck.walk();
```

## è®¾è®¡æ¨¡å¼ä¸ç±»

### å•ä¾‹æ¨¡å¼

ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼š

```javascript
class DatabaseConnection {
  constructor() {
    if (DatabaseConnection.instance) {
      return DatabaseConnection.instance;
    }

    this.host = 'localhost';
    this.port = 5432;
    this.database = 'myapp';
    this.connected = false;

    DatabaseConnection.instance = this;
  }

  connect() {
    if (!this.connected) {
      console.log(`è¿æ¥åˆ°æ•°æ®åº“ ${this.database}@${this.host}:${this.port}`);
      this.connected = true;
    }
    return this;
  }

  disconnect() {
    if (this.connected) {
      console.log('æ–­å¼€æ•°æ®åº“è¿æ¥');
      this.connected = false;
    }
    return this;
  }

  query(sql) {
    if (!this.connected) {
      throw new Error('æ•°æ®åº“æœªè¿æ¥');
    }
    console.log(`æ‰§è¡ŒæŸ¥è¯¢: ${sql}`);
    return { rows: [], count: 0 };
  }

  static getInstance() {
    if (!DatabaseConnection.instance) {
      DatabaseConnection.instance = new DatabaseConnection();
    }
    return DatabaseConnection.instance;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const db1 = new DatabaseConnection();
const db2 = new DatabaseConnection();
const db3 = DatabaseConnection.getInstance();

console.log(db1 === db2); // trueï¼ŒåŒä¸€ä¸ªå®ä¾‹
console.log(db2 === db3); // true

db1.connect().query('SELECT * FROM users');
```

### å·¥å‚æ¨¡å¼

æ ¹æ®å‚æ•°åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼š

```javascript
// äº§å“åŸºç±»
class Vehicle {
  constructor(make, model) {
    this.make = make;
    this.model = model;
  }

  start() {
    console.log(`${this.make} ${this.model} å¯åŠ¨äº†`);
  }

  stop() {
    console.log(`${this.make} ${this.model} åœæ­¢äº†`);
  }
}

// å…·ä½“äº§å“ç±»
class Car extends Vehicle {
  constructor(make, model, doors) {
    super(make, model);
    this.doors = doors;
    this.type = 'car';
  }

  openTrunk() {
    console.log('åå¤‡ç®±æ‰“å¼€äº†');
  }
}

class Motorcycle extends Vehicle {
  constructor(make, model, engineSize) {
    super(make, model);
    this.engineSize = engineSize;
    this.type = 'motorcycle';
  }

  wheelie() {
    console.log('æ‘©æ‰˜è½¦ç¿˜èµ·å‰è½®');
  }
}

class Truck extends Vehicle {
  constructor(make, model, capacity) {
    super(make, model);
    this.capacity = capacity;
    this.type = 'truck';
  }

  loadCargo() {
    console.log(`è£…è½½è´§ç‰©ï¼Œå®¹é‡ï¼š${this.capacity}å¨`);
  }
}

// å·¥å‚ç±»
class VehicleFactory {
  static createVehicle(type, make, model, extra) {
    switch (type.toLowerCase()) {
      case 'car':
        return new Car(make, model, extra);
      case 'motorcycle':
        return new Motorcycle(make, model, extra);
      case 'truck':
        return new Truck(make, model, extra);
      default:
        throw new Error(`ä¸æ”¯æŒçš„è½¦è¾†ç±»å‹: ${type}`);
    }
  }

  // æ³¨å†Œæ–°çš„è½¦è¾†ç±»å‹
  static registerVehicleType(type, vehicleClass) {
    this.vehicleTypes = this.vehicleTypes || {};
    this.vehicleTypes[type.toLowerCase()] = vehicleClass;
  }

  static createRegisteredVehicle(type, ...args) {
    const VehicleClass = this.vehicleTypes?.[type.toLowerCase()];
    if (!VehicleClass) {
      throw new Error(`æœªæ³¨å†Œçš„è½¦è¾†ç±»å‹: ${type}`);
    }
    return new VehicleClass(...args);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const car = VehicleFactory.createVehicle('car', 'ä¸°ç”°', 'å¡ç½—æ‹‰', 4);
const motorcycle = VehicleFactory.createVehicle('motorcycle', 'æœ¬ç”°', 'CBR600', 600);
const truck = VehicleFactory.createVehicle('truck', 'æ²ƒå°”æ²ƒ', 'FH16', 40);

car.start();
car.openTrunk();

motorcycle.start();
motorcycle.wheelie();

truck.start();
truck.loadCargo();

// æ³¨å†Œæ–°ç±»å‹
class Bicycle extends Vehicle {
  constructor(make, model, gears) {
    super(make, model);
    this.gears = gears;
    this.type = 'bicycle';
  }

  pedal() {
    console.log('å¼€å§‹è¸©è¸æ¿');
  }
}

VehicleFactory.registerVehicleType('bicycle', Bicycle);
const bike = VehicleFactory.createRegisteredVehicle('bicycle', 'æ·å®‰ç‰¹', 'ATX', 21);
bike.pedal();
```

### è§‚å¯Ÿè€…æ¨¡å¼

å®ç°å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼š

```javascript
// è§‚å¯Ÿè€…æ¥å£
class Observer {
  update(data) {
    throw new Error('updateæ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­å®ç°');
  }
}

// ä¸»é¢˜ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰
class Subject {
  constructor() {
    this.observers = [];
  }

  addObserver(observer) {
    if (!(observer instanceof Observer)) {
      throw new Error('è§‚å¯Ÿè€…å¿…é¡»å®ç°Observeræ¥å£');
    }
    this.observers.push(observer);
  }

  removeObserver(observer) {
    const index = this.observers.indexOf(observer);
    if (index > -1) {
      this.observers.splice(index, 1);
    }
  }

  notifyObservers(data) {
    this.observers.forEach(observer => observer.update(data));
  }
}

// å…·ä½“ä¸»é¢˜ï¼šæ–°é—»å‘å¸ƒè€…
class NewsPublisher extends Subject {
  constructor() {
    super();
    this.news = [];
  }

  publishNews(title, content, category) {
    const newsItem = {
      id: Date.now(),
      title,
      content,
      category,
      publishTime: new Date()
    };

    this.news.push(newsItem);
    this.notifyObservers(newsItem);
  }

  getNews() {
    return [...this.news];
  }
}

// å…·ä½“è§‚å¯Ÿè€…ï¼šæ–°é—»è®¢é˜…è€…
class NewsSubscriber extends Observer {
  constructor(name, interests = []) {
    super();
    this.name = name;
    this.interests = interests;
    this.receivedNews = [];
  }

  update(newsItem) {
    // å¦‚æœæ²¡æœ‰æŒ‡å®šå…´è¶£æˆ–æ–°é—»ç±»åˆ«åœ¨å…´è¶£èŒƒå›´å†…
    if (this.interests.length === 0 || this.interests.includes(newsItem.category)) {
      this.receivedNews.push(newsItem);
      console.log(`${this.name}æ”¶åˆ°æ–°é—»: ${newsItem.title}`);
    }
  }

  getReceivedNews() {
    return [...this.receivedNews];
  }
}

// å…·ä½“è§‚å¯Ÿè€…ï¼šé‚®ä»¶é€šçŸ¥æœåŠ¡
class EmailNotificationService extends Observer {
  constructor() {
    super();
    this.sentEmails = [];
  }

  update(newsItem) {
    const email = {
      to: 'subscribers@news.com',
      subject: `æ–°é—»å¿«æŠ¥: ${newsItem.title}`,
      body: newsItem.content,
      sentAt: new Date()
    };

    this.sentEmails.push(email);
    console.log(`é‚®ä»¶é€šçŸ¥å·²å‘é€: ${newsItem.title}`);
  }

  getSentEmails() {
    return [...this.sentEmails];
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const publisher = new NewsPublisher();

const subscriber1 = new NewsSubscriber('å¼ ä¸‰', ['ç§‘æŠ€', 'ä½“è‚²']);
const subscriber2 = new NewsSubscriber('æå››', ['è´¢ç»']);
const subscriber3 = new NewsSubscriber('ç‹äº”'); // è®¢é˜…æ‰€æœ‰ç±»åˆ«
const emailService = new EmailNotificationService();

// æ·»åŠ è§‚å¯Ÿè€…
publisher.addObserver(subscriber1);
publisher.addObserver(subscriber2);
publisher.addObserver(subscriber3);
publisher.addObserver(emailService);

// å‘å¸ƒæ–°é—»
publisher.publishNews('AIæŠ€æœ¯çªç ´', 'ChatGPTå‘å¸ƒæ–°ç‰ˆæœ¬...', 'ç§‘æŠ€');
publisher.publishNews('è‚¡å¸‚å¤§æ¶¨', 'ä»Šæ—¥è‚¡å¸‚è¡¨ç°å¼ºåŠ²...', 'è´¢ç»');
publisher.publishNews('ä¸–ç•Œæ¯å†³èµ›', 'ç²¾å½©çš„è¶³çƒæ¯”èµ›...', 'ä½“è‚²');

console.log('\nè®¢é˜…è€…æ”¶åˆ°çš„æ–°é—»æ•°é‡:');
console.log(`å¼ ä¸‰: ${subscriber1.getReceivedNews().length}æ¡`);
console.log(`æå››: ${subscriber2.getReceivedNews().length}æ¡`);
console.log(`ç‹äº”: ${subscriber3.getReceivedNews().length}æ¡`);
```

### è£…é¥°å™¨æ¨¡å¼

åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½ï¼š

```javascript
// åŸºç¡€ç»„ä»¶
class Coffee {
  constructor() {
    this.description = 'æ™®é€šå’–å•¡';
    this.cost = 10;
  }

  getDescription() {
    return this.description;
  }

  getCost() {
    return this.cost;
  }
}

// è£…é¥°å™¨åŸºç±»
class CoffeeDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }

  getDescription() {
    return this.coffee.getDescription();
  }

  getCost() {
    return this.coffee.getCost();
  }
}

// å…·ä½“è£…é¥°å™¨
class MilkDecorator extends CoffeeDecorator {
  constructor(coffee) {
    super(coffee);
  }

  getDescription() {
    return this.coffee.getDescription() + ', åŠ ç‰›å¥¶';
  }

  getCost() {
    return this.coffee.getCost() + 3;
  }
}

class SugarDecorator extends CoffeeDecorator {
  constructor(coffee) {
    super(coffee);
  }

  getDescription() {
    return this.coffee.getDescription() + ', åŠ ç³–';
  }

  getCost() {
    return this.coffee.getCost() + 1;
  }
}

class WhipDecorator extends CoffeeDecorator {
  constructor(coffee) {
    super(coffee);
  }

  getDescription() {
    return this.coffee.getDescription() + ', åŠ å¥¶æ³¡';
  }

  getCost() {
    return this.coffee.getCost() + 5;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let coffee = new Coffee();
console.log(`${coffee.getDescription()} - Â¥${coffee.getCost()}`);

// æ·»åŠ è£…é¥°
coffee = new MilkDecorator(coffee);
console.log(`${coffee.getDescription()} - Â¥${coffee.getCost()}`);

coffee = new SugarDecorator(coffee);
console.log(`${coffee.getDescription()} - Â¥${coffee.getCost()}`);

coffee = new WhipDecorator(coffee);
console.log(`${coffee.getDescription()} - Â¥${coffee.getCost()}`);
// æœ€ç»ˆè¾“å‡º: æ™®é€šå’–å•¡, åŠ ç‰›å¥¶, åŠ ç³–, åŠ å¥¶æ³¡ - Â¥19
```

## ç±»ä¸ç°ä»£JavaScript

### ç±»ä¸æ¨¡å—åŒ–

```javascript
// user.js - ç”¨æˆ·æ¨¡å—
export class User {
  constructor(username, email) {
    this.username = username;
    this.email = email;
    this.createdAt = new Date();
  }

  getProfile() {
    return {
      username: this.username,
      email: this.email,
      createdAt: this.createdAt
    };
  }
}

export class AdminUser extends User {
  constructor(username, email, permissions = []) {
    super(username, email);
    this.permissions = permissions;
    this.role = 'admin';
  }

  hasPermission(permission) {
    return this.permissions.includes(permission);
  }

  addPermission(permission) {
    if (!this.hasPermission(permission)) {
      this.permissions.push(permission);
    }
  }
}

// userManager.js - ç”¨æˆ·ç®¡ç†æ¨¡å—
import { User, AdminUser } from './user.js';

export class UserManager {
  constructor() {
    this.users = new Map();
  }

  createUser(username, email, isAdmin = false, permissions = []) {
    const user = isAdmin
      ? new AdminUser(username, email, permissions)
      : new User(username, email);

    this.users.set(username, user);
    return user;
  }

  getUser(username) {
    return this.users.get(username);
  }

  getAllUsers() {
    return Array.from(this.users.values());
  }

  deleteUser(username) {
    return this.users.delete(username);
  }
}

// main.js - ä¸»åº”ç”¨
import { UserManager } from './userManager.js';

const userManager = new UserManager();

const regularUser = userManager.createUser('john', 'john@example.com');
const admin = userManager.createUser('admin', 'admin@example.com', true, ['read', 'write', 'delete']);

console.log(regularUser.getProfile());
console.log(admin.hasPermission('delete')); // true
```

### ç±»ä¸å¼‚æ­¥ç¼–ç¨‹

```javascript
class DataService {
  constructor(baseUrl) {
    this.baseUrl = baseUrl;
    this.cache = new Map();
  }

  async fetchData(endpoint) {
    const url = `${this.baseUrl}/${endpoint}`;

    // æ£€æŸ¥ç¼“å­˜
    if (this.cache.has(url)) {
      console.log('ä»ç¼“å­˜è·å–æ•°æ®');
      return this.cache.get(url);
    }

    try {
      console.log(`æ­£åœ¨è·å–æ•°æ®: ${url}`);
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
      }

      const data = await response.json();

      // ç¼“å­˜æ•°æ®
      this.cache.set(url, data);

      return data;
    } catch (error) {
      console.error('è·å–æ•°æ®å¤±è´¥:', error);
      throw error;
    }
  }

  async batchFetch(endpoints) {
    const promises = endpoints.map(endpoint => this.fetchData(endpoint));
    return Promise.all(promises);
  }

  clearCache() {
    this.cache.clear();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const dataService = new DataService('https://api.example.com');

async function loadUserData() {
  try {
    const userData = await dataService.fetchData('users/123');
    const userPosts = await dataService.fetchData('users/123/posts');

    console.log('ç”¨æˆ·æ•°æ®:', userData);
    console.log('ç”¨æˆ·å¸–å­:', userPosts);
  } catch (error) {
    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
  }
}
```

## æœ€ä½³å®è·µ

### ç±»è®¾è®¡åŸåˆ™

#### å•ä¸€èŒè´£åŸåˆ™

æ¯ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š

```javascript
// ä¸å¥½çš„è®¾è®¡ï¼šä¸€ä¸ªç±»æ‰¿æ‹…å¤šä¸ªèŒè´£
class BadUser {
  constructor(username, email) {
    this.username = username;
    this.email = email;
  }

  // ç”¨æˆ·æ•°æ®éªŒè¯
  validateEmail() {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email);
  }

  // æ•°æ®åº“æ“ä½œ
  save() {
    // ä¿å­˜åˆ°æ•°æ®åº“çš„é€»è¾‘
  }

  // é‚®ä»¶å‘é€
  sendWelcomeEmail() {
    // å‘é€æ¬¢è¿é‚®ä»¶çš„é€»è¾‘
  }

  // æ—¥å¿—è®°å½•
  log(message) {
    console.log(`[${new Date()}] ${message}`);
  }
}

// å¥½çš„è®¾è®¡ï¼šèŒè´£åˆ†ç¦»
class User {
  constructor(username, email) {
    this.username = username;
    this.email = email;
  }

  getProfile() {
    return {
      username: this.username,
      email: this.email
    };
  }
}

class UserValidator {
  static validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  static validateUsername(username) {
    return username && username.length >= 3;
  }
}

class UserRepository {
  async save(user) {
    // ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“
  }

  async findByUsername(username) {
    // ä»æ•°æ®åº“æŸ¥æ‰¾ç”¨æˆ·
  }
}

class EmailService {
  async sendWelcomeEmail(user) {
    // å‘é€æ¬¢è¿é‚®ä»¶
  }
}

class Logger {
  static log(level, message) {
    console.log(`[${new Date()}] [${level}] ${message}`);
  }
}
```

#### å¼€é—­åŸåˆ™

å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š

```javascript
// åŸºç¡€æ”¯ä»˜å¤„ç†å™¨
class PaymentProcessor {
  processPayment(amount, method) {
    throw new Error('processPaymentæ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­å®ç°');
  }
}

// å…·ä½“æ”¯ä»˜æ–¹å¼
class CreditCardProcessor extends PaymentProcessor {
  processPayment(amount, cardInfo) {
    console.log(`ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ Â¥${amount}`);
    // ä¿¡ç”¨å¡æ”¯ä»˜é€»è¾‘
    return { success: true, transactionId: 'cc_' + Date.now() };
  }
}

class PayPalProcessor extends PaymentProcessor {
  processPayment(amount, paypalInfo) {
    console.log(`ä½¿ç”¨PayPalæ”¯ä»˜ Â¥${amount}`);
    // PayPalæ”¯ä»˜é€»è¾‘
    return { success: true, transactionId: 'pp_' + Date.now() };
  }
}

class AlipayProcessor extends PaymentProcessor {
  processPayment(amount, alipayInfo) {
    console.log(`ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ Â¥${amount}`);
    // æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘
    return { success: true, transactionId: 'ap_' + Date.now() };
  }
}

// æ”¯ä»˜ç®¡ç†å™¨
class PaymentManager {
  constructor() {
    this.processors = new Map();
  }

  registerProcessor(type, processor) {
    this.processors.set(type, processor);
  }

  processPayment(type, amount, paymentInfo) {
    const processor = this.processors.get(type);
    if (!processor) {
      throw new Error(`ä¸æ”¯æŒçš„æ”¯ä»˜æ–¹å¼: ${type}`);
    }
    return processor.processPayment(amount, paymentInfo);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const paymentManager = new PaymentManager();
paymentManager.registerProcessor('creditcard', new CreditCardProcessor());
paymentManager.registerProcessor('paypal', new PayPalProcessor());
paymentManager.registerProcessor('alipay', new AlipayProcessor());

// æ·»åŠ æ–°çš„æ”¯ä»˜æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
class WeChatPayProcessor extends PaymentProcessor {
  processPayment(amount, wechatInfo) {
    console.log(`ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ Â¥${amount}`);
    return { success: true, transactionId: 'wx_' + Date.now() };
  }
}

paymentManager.registerProcessor('wechat', new WeChatPayProcessor());
```

#### é‡Œæ°æ›¿æ¢åŸåˆ™

å­ç±»åº”è¯¥èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»ï¼š

```javascript
// åŸºç±»
class Bird {
  fly() {
    console.log('é¸Ÿå„¿åœ¨é£ç¿”');
  }
}

// è¿åLSPçš„è®¾è®¡
class Penguin extends Bird {
  fly() {
    throw new Error('ä¼é¹…ä¸ä¼šé£'); // è¿åäº†LSP
  }
}

// æ›´å¥½çš„è®¾è®¡
class Animal {
  move() {
    console.log('åŠ¨ç‰©åœ¨ç§»åŠ¨');
  }
}

class FlyingBird extends Animal {
  move() {
    this.fly();
  }

  fly() {
    console.log('é¸Ÿå„¿åœ¨é£ç¿”');
  }
}

class SwimmingBird extends Animal {
  move() {
    this.swim();
  }

  swim() {
    console.log('é¸Ÿå„¿åœ¨æ¸¸æ³³');
  }
}

class Eagle extends FlyingBird {}
class Penguin extends SwimmingBird {}

function makeAnimalMove(animal) {
  animal.move();
}

makeAnimalMove(new Eagle());
makeAnimalMove(new Penguin());
```

### æ€§èƒ½è€ƒé‡

#### é¿å…åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºæ–¹æ³•

```javascript
// ä¸å¥½çš„åšæ³•
class BadCounter {
  constructor() {
    this.count = 0;
    this.increment = function() {
      this.count++;
    };
  }
}

// å¥½çš„åšæ³•
class GoodCounter {
  constructor() {
    this.count = 0;
  }

  increment() {
    this.count++;
  }
}
```

#### åˆç†ä½¿ç”¨ç§æœ‰å­—æ®µ

```javascript
class OptimizedClass {
  constructor(publicData, privateData) {
    this.publicData = publicData;
    this.#privateData = privateData;
  }

  #privateData;

  getPrivateData() {
    return this.#privateData;
  }
}
```

### æµ‹è¯•å‹å¥½çš„ç±»è®¾è®¡

```javascript
class UserService {
  constructor(userRepository, emailService, logger) {
    this.userRepository = userRepository;
    this.emailService = emailService;
    this.logger = logger;
  }

  async createUser(userData) {
    try {
      // éªŒè¯ç”¨æˆ·æ•°æ®
      this.validateUserData(userData);

      // åˆ›å»ºç”¨æˆ·
      const user = await this.userRepository.create(userData);

      // å‘é€æ¬¢è¿é‚®ä»¶
      await this.emailService.sendWelcomeEmail(user);

      // è®°å½•æ—¥å¿—
      this.logger.info(`ç”¨æˆ·åˆ›å»ºæˆåŠŸ: ${user.username}`);

      return user;
    } catch (error) {
      this.logger.error(`ç”¨æˆ·åˆ›å»ºå¤±è´¥: ${error.message}`);
      throw error;
    }
  }

  validateUserData(userData) {
    if (!userData.username) {
      throw new Error('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
    }
    if (!userData.email) {
      throw new Error('é‚®ç®±ä¸èƒ½ä¸ºç©º');
    }
    // æ›´å¤šéªŒè¯é€»è¾‘...
  }
}

// æµ‹è¯•ç¤ºä¾‹ï¼ˆä½¿ç”¨Jestï¼‰
describe('UserService', () => {
  let userService;
  let mockUserRepository;
  let mockEmailService;
  let mockLogger;

  beforeEach(() => {
    mockUserRepository = {
      create: jest.fn()
    };
    mockEmailService = {
      sendWelcomeEmail: jest.fn()
    };
    mockLogger = {
      info: jest.fn(),
      error: jest.fn()
    };

    userService = new UserService(mockUserRepository, mockEmailService, mockLogger);
  });

  test('åº”è¯¥æˆåŠŸåˆ›å»ºç”¨æˆ·', async () => {
    const userData = { username: 'test', email: 'test@example.com' };
    const createdUser = { id: 1, ...userData };

    mockUserRepository.create.mockResolvedValue(createdUser);

    const result = await userService.createUser(userData);

    expect(result).toEqual(createdUser);
    expect(mockUserRepository.create).toHaveBeenCalledWith(userData);
    expect(mockEmailService.sendWelcomeEmail).toHaveBeenCalledWith(createdUser);
    expect(mockLogger.info).toHaveBeenCalled();
  });
});
```

## æ€»ç»“

JavaScriptçš„ç±»è¯­æ³•è®©é¢å‘å¯¹è±¡ç¼–ç¨‹å˜å¾—æ›´åŠ ç›´è§‚ã€‚è™½ç„¶åº•å±‚ä»ç„¶æ˜¯åŸºäºåŸå‹çš„ï¼Œä½†ç±»æä¾›äº†æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡æ–¹å¼ã€‚

æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬å°è£…ã€ç»§æ‰¿ã€å¤šæ€å’ŒæŠ½è±¡ã€‚ç°ä»£JavaScriptæ”¯æŒç§æœ‰å­—æ®µã€é™æ€æˆå‘˜ã€è®¿é—®å™¨å±æ€§ç­‰ç‰¹æ€§ï¼Œè®©ç±»çš„åŠŸèƒ½æ›´åŠ å®Œå–„ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†è¿ç”¨è®¾è®¡æ¨¡å¼èƒ½å¤Ÿè§£å†³å¸¸è§çš„ç¼–ç¨‹é—®é¢˜ã€‚åŒæ—¶è¦æ³¨æ„éµå¾ªè®¾è®¡åŸåˆ™ï¼Œç¼–å†™å¯ç»´æŠ¤çš„ä»£ç ã€‚

ç±»ä¸å‡½æ•°å¼ç¼–ç¨‹å„æœ‰ä¼˜åŠ¿ï¼Œé€‰æ‹©åˆé€‚çš„ç¼–ç¨‹èŒƒå¼å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œå›¢é˜Ÿåå¥½ã€‚
